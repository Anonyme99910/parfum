import{b as ie,r,g as j,h as ce,c,o as d,d as e,j as S,e as v,k as m,v as b,l as o,x as K,F as U,m as $,t as i,s as O,z as de,B as pe,w as R,y}from"./index-DjPdbN3A.js";import{f as P,t as I}from"./numbers-BTmV-EI5.js";import{c as B}from"./createLucideIcon-Bv2X9owl.js";import{P as ve}from"./package-BF0xPaQ_.js";import{P as me}from"./plus-BeALTBP5.js";import{T as ye}from"./trash-2-CEfbzb8P.js";import{U as fe}from"./user-plus-QxTT-iQ0.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=B("MinusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=B("ScanIcon",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=B("SearchIcon",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=B("ShoppingCartIcon",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),_e={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ke={class:"lg:col-span-2 space-y-4"},we={class:"card"},Ce={class:"flex gap-3"},qe={class:"flex-1 relative"},Me={class:"grid grid-cols-2 md:grid-cols-3 gap-4"},Pe=["onClick"],ze={class:"aspect-square bg-gray-100 rounded-lg mb-3 flex items-center justify-center"},Ve={class:"font-bold text-gray-900 mb-1 truncate"},je={class:"text-sm text-gray-500 mb-2"},Se={class:"flex items-center justify-between"},Ue={class:"text-lg font-bold text-primary-600"},$e={class:"space-y-4"},Ie={class:"card sticky top-24"},Be={class:"text-xl font-bold mb-4 flex items-center gap-2"},Fe={class:"space-y-3 mb-4 max-h-64 overflow-y-auto"},Te={key:0,class:"text-center py-8 text-gray-500"},De={class:"flex-1"},Ne={class:"font-medium text-sm"},Ae={class:"text-xs text-gray-500"},Le={class:"flex items-center gap-2"},Ee=["onClick"],Qe={class:"w-8 text-center font-bold"},We=["onClick"],He=["onClick"],Ke={class:"mb-4"},Oe={class:"flex gap-2"},Re=["value"],Ge={class:"border-t pt-4 space-y-2"},Je={class:"flex justify-between text-sm"},Xe={class:"font-bold"},Ye={class:"flex justify-between text-sm"},Ze={class:"flex justify-between text-sm"},et={class:"flex justify-between text-lg font-bold border-t pt-2"},tt={class:"text-primary-600"},st={class:"flex justify-between text-sm bg-blue-50 p-2 rounded"},at=["placeholder"],ot={key:0,class:"flex justify-between text-sm text-red-600 font-bold"},nt={class:"mt-4"},lt={class:"grid grid-cols-3 gap-2"},rt=["onClick"],ut={class:"mt-4 space-y-2"},it=["disabled"],ct={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},dt={class:"bg-white rounded-xl p-6 w-full max-w-md"},pt={class:"flex gap-3"},vt={class:"bg-white rounded-xl p-6 w-full max-w-md"},mt={class:"flex gap-3"},wt={__name:"POS",setup(yt){const n=ie(),k=r([]),z=r([]),u=r([]),f=r(""),w=r(""),x=r(0),g=r(0),C=r(null),F=r("cash"),V=r(!1),q=r(!1),h=r(""),A=r(null),_=r({name:"",phone:""}),G=[{value:"cash",label:"نقدي"},{value:"card",label:"بطاقة"},{value:"transfer",label:"تحويل"}],J=j(()=>f.value?k.value.filter(a=>a.name_ar.includes(f.value)||a.barcode.includes(f.value)):k.value.slice(0,12)),L=j(()=>u.value.reduce((a,t)=>a+t.product.selling_price*t.quantity,0)),M=j(()=>L.value+g.value-x.value),E=j(()=>{const a=C.value||M.value;return Math.max(0,M.value-a)}),X=async()=>{if(f.value.length<2){T();return}try{const a=await y.getProducts({search:f.value});k.value=a.data}catch{n.error("فشل البحث")}},Y=()=>{V.value=!0,h.value="",setTimeout(()=>{var a;(a=A.value)==null||a.focus()},100)},Q=async()=>{if(h.value)try{const a=await y.searchByBarcode(h.value);W(a.data),V.value=!1,h.value=""}catch{n.error("المنتج غير موجود")}},W=a=>{if(a.stock_quantity===0){n.error("المنتج غير متوفر في المخزون");return}const t=u.value.find(s=>s.product.id===a.id);if(t){if(t.quantity>=a.stock_quantity){n.error("الكمية المطلوبة غير متوفرة");return}t.quantity++}else u.value.push({product:a,quantity:1});n.success("تم إضافة المنتج للسلة")},Z=a=>{if(a.quantity>=a.product.stock_quantity){n.error("الكمية المطلوبة غير متوفرة");return}a.quantity++},ee=a=>{a.quantity>1?a.quantity--:H(a)},H=a=>{u.value=u.value.filter(t=>t.product.id!==a.product.id)},te=()=>{u.value.length!==0&&confirm("هل أنت متأكد من مسح السلة؟")&&(u.value=[],x.value=0,g.value=0)},se=async()=>{try{const a=await y.createCustomer(_.value);n.success("تم إضافة العميل بنجاح"),z.value.push(a.data),w.value=a.data.id,q.value=!1,_.value={name:"",phone:""}}catch{n.error("فشل إضافة العميل")}},ae=async()=>{var t,s,p;if(u.value.length===0)return;const a={customer_id:w.value||null,items:u.value.map(l=>({product_id:l.product.id,quantity:l.quantity,unit_price:l.product.selling_price})),tax:g.value,discount:x.value,paid_amount:C.value||M.value,payment_method:F.value};try{const l=await y.createSale(a),D=I(l.data.invoice_number);n.success(`تم إنشاء الفاتورة ${D}`);const le=[];if(confirm("هل تريد تحميل الفاتورة PDF؟"))try{await y.downloadInvoicePdf(l.data.id),n.success("تم تحميل الفاتورة بنجاح")}catch(N){console.error("PDF Error:",N),n.error("فشل تحميل الفاتورة PDF")}(t=l.data.customer)!=null&&t.phone&&confirm("هل تريد مشاركة الفاتورة عبر واتساب؟")&&oe(l.data),u.value=[],x.value=0,g.value=0,C.value=null,w.value="",T()}catch(l){n.error(((p=(s=l.response)==null?void 0:s.data)==null?void 0:p.error)||"فشل إنشاء الفاتورة")}},oe=async a=>{try{const t=await y.getWhatsAppMessage(a.id),{message:s,pdf_url:p,phone:l}=t.data;if(!l){n.error("لا يوجد رقم هاتف للعميل");return}const D=l.replace(/[^0-9]/g,""),N=`
`+"-".repeat(30)+`
`+`تحميل الفاتورة:
`+p,re=s+N,ue=`https://wa.me/${D}?text=${encodeURIComponent(re)}`;window.open(ue,"_blank"),n.success("تم فتح واتساب بنجاح")}catch(t){console.error("WhatsApp Error:",t),n.error("فشل مشاركة الفاتورة عبر واتساب")}},T=async()=>{try{const a=await y.getProducts();k.value=a.data.data||a.data||[]}catch(a){console.error("Failed to load products:",a),k.value=[]}},ne=async()=>{try{const a=await y.getCustomers();z.value=a.data.data||a.data||[]}catch(a){console.error("Failed to load customers:",a),z.value=[]}};return ce(()=>{T(),ne()}),(a,t)=>(d(),c("div",_e,[e("div",ke,[e("div",we,[e("div",Ce,[e("div",qe,[v(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>f.value=s),onInput:X,type:"text",placeholder:"ابحث بالاسم أو الباركود...",class:"input pl-10"},null,544),[[b,f.value]]),m(o(ge),{class:"absolute left-3 top-3 text-gray-400",size:20})]),e("button",{onClick:Y,class:"btn btn-primary flex items-center gap-2"},[m(o(xe),{size:20}),t[12]||(t[12]=K(" مسح الباركود ",-1))])])]),e("div",Me,[(d(!0),c(U,null,$(J.value,s=>{var p;return d(),c("div",{key:s.id,onClick:l=>W(s),class:"card hover:shadow-lg cursor-pointer transition-all hover:scale-105"},[e("div",ze,[m(o(ve),{size:48,class:"text-gray-400"})]),e("h4",Ve,i(s.name_ar),1),e("p",je,i((p=s.brand)==null?void 0:p.name_ar),1),e("div",Se,[e("span",Ue,i(o(P)(s.selling_price)),1),e("span",{class:O(["text-xs badge",s.stock_quantity>0?"badge-success":"badge-danger"])},i(o(I)(s.stock_quantity))+" قطعة ",3)])],8,Pe)}),128))])]),e("div",$e,[e("div",Ie,[e("h3",Be,[m(o(he),{size:24}),t[13]||(t[13]=K(" سلة المشتريات ",-1))]),e("div",Fe,[u.value.length===0?(d(),c("div",Te," السلة فارغة ")):S("",!0),(d(!0),c(U,null,$(u.value,s=>(d(),c("div",{key:s.product.id,class:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg"},[e("div",De,[e("p",Ne,i(s.product.name_ar),1),e("p",Ae,i(o(P)(s.product.selling_price)),1)]),e("div",Le,[e("button",{onClick:p=>ee(s),class:"w-7 h-7 rounded bg-gray-200 hover:bg-gray-300"},[m(o(be),{size:16,class:"mx-auto"})],8,Ee),e("span",Qe,i(o(I)(s.quantity)),1),e("button",{onClick:p=>Z(s),class:"w-7 h-7 rounded bg-gray-200 hover:bg-gray-300"},[m(o(me),{size:16,class:"mx-auto"})],8,We)]),e("button",{onClick:p=>H(s),class:"text-red-600 hover:text-red-800"},[m(o(ye),{size:18})],8,He)]))),128))]),e("div",Ke,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium mb-2"},"العميل (اختياري)",-1)),e("div",Oe,[v(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>w.value=s),class:"input flex-1"},[t[14]||(t[14]=e("option",{value:""},"عميل عادي",-1)),(d(!0),c(U,null,$(z.value,s=>(d(),c("option",{key:s.id,value:s.id},i(s.name)+" - "+i(o(I)(s.phone)),9,Re))),128))],512),[[de,w.value]]),e("button",{onClick:t[2]||(t[2]=s=>q.value=!0),class:"btn btn-secondary"},[m(o(fe),{size:18})])])]),e("div",Ge,[e("div",Je,[t[16]||(t[16]=e("span",null,"المجموع الفرعي:",-1)),e("span",Xe,i(o(P)(L.value)),1)]),e("div",Ye,[t[17]||(t[17]=e("span",null,"الخصم:",-1)),v(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>x.value=s),type:"number",step:"0.01",class:"input w-32 text-left py-1"},null,512),[[b,x.value,void 0,{number:!0}]])]),e("div",Ze,[t[18]||(t[18]=e("span",null,"الضريبة:",-1)),v(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>g.value=s),type:"number",step:"0.01",class:"input w-32 text-left py-1"},null,512),[[b,g.value,void 0,{number:!0}]])]),e("div",et,[t[19]||(t[19]=e("span",null,"الإجمالي:",-1)),e("span",tt,i(o(P)(M.value)),1)]),e("div",st,[t[20]||(t[20]=e("span",null,"المبلغ المدفوع:",-1)),v(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>C.value=s),type:"number",step:"0.01",placeholder:M.value.toString(),class:"input w-32 text-left py-1"},null,8,at),[[b,C.value,void 0,{number:!0}]])]),E.value>0?(d(),c("div",ot,[t[21]||(t[21]=e("span",null,"المتبقي:",-1)),e("span",null,i(o(P)(E.value)),1)])):S("",!0)]),e("div",nt,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium mb-2"},"طريقة الدفع",-1)),e("div",lt,[(d(),c(U,null,$(G,s=>e("button",{key:s.value,onClick:p=>F.value=s.value,class:O([F.value===s.value?"bg-primary-600 text-white":"bg-gray-100","py-2 rounded-lg font-medium transition-all"])},i(s.label),11,rt)),64))])]),e("div",ut,[e("button",{onClick:ae,disabled:u.value.length===0,class:"btn btn-success w-full py-3 text-lg"}," إتمام البيع ",8,it),e("button",{onClick:te,class:"btn btn-secondary w-full"}," مسح السلة ")])])]),V.value?(d(),c("div",ct,[e("div",dt,[t[23]||(t[23]=e("h3",{class:"text-2xl font-bold mb-4"},"مسح الباركود",-1)),v(e("input",{ref_key:"barcodeInput",ref:A,"onUpdate:modelValue":t[6]||(t[6]=s=>h.value=s),onKeyup:pe(Q,["enter"]),type:"text",placeholder:"امسح أو اكتب الباركود...",class:"input mb-4",autofocus:""},null,544),[[b,h.value]]),e("div",pt,[e("button",{onClick:t[7]||(t[7]=s=>V.value=!1),class:"btn btn-secondary flex-1"},"إلغاء"),e("button",{onClick:Q,class:"btn btn-primary flex-1"},"بحث")])])])):S("",!0),q.value?(d(),c("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t[11]||(t[11]=R(s=>q.value=!1,["self"]))},[e("div",vt,[t[27]||(t[27]=e("h3",{class:"text-2xl font-bold mb-4"},"إضافة عميل",-1)),e("form",{onSubmit:R(se,["prevent"]),class:"space-y-4"},[e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium mb-2"},"الاسم *",-1)),v(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>_.value.name=s),type:"text",required:"",class:"input"},null,512),[[b,_.value.name]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium mb-2"},"رقم الهاتف *",-1)),v(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>_.value.phone=s),type:"tel",required:"",class:"input"},null,512),[[b,_.value.phone]])]),e("div",mt,[e("button",{type:"button",onClick:t[10]||(t[10]=s=>q.value=!1),class:"btn btn-secondary flex-1"},"إلغاء"),t[26]||(t[26]=e("button",{type:"submit",class:"btn btn-primary flex-1"},"حفظ",-1))])],32)])])):S("",!0)]))}};export{wt as default};
