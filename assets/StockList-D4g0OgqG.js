import{_ as N,b as B,r,h as E,c as n,o as u,d as t,j as f,k as h,x as H,l as w,e as k,v as S,A as K,t as o,F as g,m as q,s as C,z as G,w as $,y as p}from"./index-DyWVem4z.js";import{P as J}from"./plus-Y9XiTSYj.js";import{P as O}from"./pen-square-DlN6EZcP.js";import{c as Q}from"./createLucideIcon--34oW_Gd.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=Q("HistoryIcon",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),W={class:"stock-container"},X={class:"header"},Y={class:"filters"},Z={class:"checkbox-label"},tt={key:0,class:"badge-danger"},lt={class:"table-container"},et={class:"actions"},st=["onClick"],ot=["onClick"],at={class:"modal-header"},nt={class:"modal-body"},ut={key:0,class:"form-group"},rt=["value"],dt={key:1,class:"selected-product"},it={class:"form-group"},ct={class:"form-group"},vt={class:"modal-footer"},kt={class:"modal-header"},yt={class:"modal-body"},bt={__name:"StockList",setup(pt){const d=B(),x=r([]),M=r([]),V=r([]),m=r(0),i=r(!1),y=r(!1),c=r(null),v=r({search:"",lowStock:!1}),a=r({product_id:"",quantity:0,note:""}),b=async()=>{try{const s={search:v.value.search||void 0,low_stock:v.value.lowStock||void 0},l=await p.getStock(s);x.value=l.data.products.data,m.value=l.data.low_stock_count}catch(s){d.error("فشل تحميل المخزون"),console.error(s)}},j=async()=>{try{const s=await p.getProducts();M.value=s.data.data||s.data}catch(s){console.error("Failed to load products:",s)}},U=s=>{c.value=s,a.value={product_id:s.id,quantity:0,note:""},i.value=!0},z=async()=>{if(!a.value.product_id){d.error("الرجاء اختيار المنتج");return}if(!a.value.quantity||a.value.quantity===0){d.error("الرجاء إدخال كمية صحيحة");return}if(!a.value.note){d.error("الرجاء إدخال سبب التعديل");return}try{await p.adjustStock(a.value),d.success("تم تعديل المخزون بنجاح"),i.value=!1,c.value=null,a.value={product_id:"",quantity:0,note:""},b()}catch(s){d.error("فشل تعديل المخزون"),console.error(s)}},T=async s=>{c.value=s;try{const l=await p.getStockMovements({product_id:s.id});V.value=l.data.data||l.data,y.value=!0}catch(l){d.error("فشل تحميل الحركات"),console.error(l)}},L=s=>s.available_qty<=0?"out":s.stock_quantity<=s.min_stock_level?"low":"ok",A=s=>{const l=L(s);return{out:"نفذ",low:"منخفض",ok:"متوفر"}[l]},D=s=>({sale:"بيع",return:"إرجاع",manual_adjust:"تعديل يدوي",purchase:"شراء",reserve:"حجز",release:"إطلاق"})[s]||s,F=s=>new Date(s).toLocaleString("ar-EG");return E(()=>{b(),j()}),(s,l)=>{var _;return u(),n("div",W,[t("div",X,[l[14]||(l[14]=t("h1",null,"إدارة المخزون",-1)),t("button",{onClick:l[0]||(l[0]=e=>i.value=!0),class:"btn-primary"},[h(w(J),{size:18}),l[13]||(l[13]=H(" تعديل المخزون ",-1))])]),t("div",Y,[k(t("input",{"onUpdate:modelValue":l[1]||(l[1]=e=>v.value.search=e),type:"text",placeholder:"بحث بالاسم أو SKU...",class:"search-input",onInput:b},null,544),[[S,v.value.search]]),t("label",Z,[k(t("input",{type:"checkbox","onUpdate:modelValue":l[2]||(l[2]=e=>v.value.lowStock=e),onChange:b},null,544),[[K,v.value.lowStock]]),l[15]||(l[15]=t("span",null,"عرض المنتجات منخفضة المخزون فقط",-1)),m.value>0?(u(),n("span",tt,o(m.value),1)):f("",!0)])]),t("div",lt,[t("table",null,[l[16]||(l[16]=t("thead",null,[t("tr",null,[t("th",null,"SKU"),t("th",null,"المنتج"),t("th",null,"الفئة"),t("th",null,"الكمية المتاحة"),t("th",null,"محجوز"),t("th",null,"المتاح للبيع"),t("th",null,"حد إعادة الطلب"),t("th",null,"الحالة"),t("th",null,"الإجراءات")])],-1)),t("tbody",null,[(u(!0),n(g,null,q(x.value,e=>{var P;return u(),n("tr",{key:e.id},[t("td",null,o(e.sku),1),t("td",null,o(e.name_ar),1),t("td",null,o((P=e.category)==null?void 0:P.name_ar),1),t("td",null,o(e.stock_quantity),1),t("td",null,o(e.reserved_qty),1),t("td",{class:C({"text-danger":e.available_qty<=0})},o(e.available_qty),3),t("td",null,o(e.min_stock_level),1),t("td",null,[t("span",{class:C(["status-badge",L(e)])},o(A(e)),3)]),t("td",et,[t("button",{onClick:I=>U(e),class:"btn-icon",title:"تعديل"},[h(w(O),{size:18})],8,st),t("button",{onClick:I=>T(e),class:"btn-icon",title:"الحركات"},[h(w(R),{size:18})],8,ot)])])}),128))])])]),i.value?(u(),n("div",{key:0,class:"modal-overlay",onClick:l[9]||(l[9]=e=>i.value=!1)},[t("div",{class:"modal",onClick:l[8]||(l[8]=$(()=>{},["stop"]))},[t("div",at,[l[17]||(l[17]=t("h3",null,"تعديل المخزون",-1)),t("button",{onClick:l[3]||(l[3]=e=>i.value=!1),class:"btn-close"},"×")]),t("div",nt,[c.value?(u(),n("div",dt,[t("strong",null,o(c.value.name_ar),1),t("span",null,"المخزون الحالي: "+o(c.value.stock_quantity),1)])):(u(),n("div",ut,[l[19]||(l[19]=t("label",null,"المنتج *",-1)),k(t("select",{"onUpdate:modelValue":l[4]||(l[4]=e=>a.value.product_id=e)},[l[18]||(l[18]=t("option",{value:""},"اختر المنتج",-1)),(u(!0),n(g,null,q(M.value,e=>(u(),n("option",{key:e.id,value:e.id},o(e.name_ar)+" ("+o(e.sku)+") ",9,rt))),128))],512),[[G,a.value.product_id]])])),t("div",it,[l[20]||(l[20]=t("label",null,"الكمية * (استخدم + للإضافة أو - للطرح)",-1)),k(t("input",{"onUpdate:modelValue":l[5]||(l[5]=e=>a.value.quantity=e),type:"number",placeholder:"مثال: +10 أو -5"},null,512),[[S,a.value.quantity,void 0,{number:!0}]])]),t("div",ct,[l[21]||(l[21]=t("label",null,"السبب *",-1)),k(t("textarea",{"onUpdate:modelValue":l[6]||(l[6]=e=>a.value.note=e),rows:"3",placeholder:"اذكر سبب التعديل...",required:""},null,512),[[S,a.value.note]])])]),t("div",vt,[t("button",{onClick:l[7]||(l[7]=e=>i.value=!1),class:"btn-secondary"},"إلغاء"),t("button",{onClick:z,class:"btn-primary"},"حفظ")])])])):f("",!0),y.value?(u(),n("div",{key:1,class:"modal-overlay",onClick:l[12]||(l[12]=e=>y.value=!1)},[t("div",{class:"modal modal-large",onClick:l[11]||(l[11]=$(()=>{},["stop"]))},[t("div",kt,[t("h3",null,"حركات المخزون - "+o((_=c.value)==null?void 0:_.name_ar),1),t("button",{onClick:l[10]||(l[10]=e=>y.value=!1),class:"btn-close"},"×")]),t("div",yt,[t("table",null,[l[22]||(l[22]=t("thead",null,[t("tr",null,[t("th",null,"التاريخ"),t("th",null,"النوع"),t("th",null,"الكمية"),t("th",null,"المخزون السابق"),t("th",null,"المخزون الجديد"),t("th",null,"الملاحظات")])],-1)),t("tbody",null,[(u(!0),n(g,null,q(V.value,e=>(u(),n("tr",{key:e.id},[t("td",null,o(F(e.moved_at||e.created_at)),1),t("td",null,o(D(e.type)),1),t("td",{class:C(e.quantity>0?"text-success":"text-danger")},o(e.quantity>0?"+":"")+o(e.quantity),3),t("td",null,o(e.previous_stock),1),t("td",null,o(e.new_stock),1),t("td",null,o(e.notes||e.note||"-"),1)]))),128))])])])])])):f("",!0)])}}},wt=N(bt,[["__scopeId","data-v-87655bb5"]]);export{wt as default};
