import{_ as A,f as E,u as G,b as T,r as x,h as W,c as a,j as p,o as r,d as t,k,x as g,l as w,t as n,s as X,F as S,m as M,e as _,v as P,z as j,D as O,w as H,y as f}from"./index-Cni0faZZ.js";import{c as V}from"./createLucideIcon-B_ZycDWX.js";import{P as J}from"./plus-BOvAC1FF.js";import{D as K,X as Q}from"./x-circle-DLlZxDKf.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=V("ArrowRightIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=V("Share2Icon",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),tt={key:0,class:"invoice-detail"},et={class:"header"},lt={class:"content"},st={class:"card"},ot={class:"info-grid"},nt={class:"info-item"},at={class:"info-item"},rt={class:"info-item"},ut={class:"info-item"},it={class:"card"},dt={class:"totals"},vt={class:"total-row"},ct={key:0,class:"total-row"},pt={key:1,class:"total-row"},mt={key:2,class:"total-row"},yt={class:"total-row total"},bt={class:"total-row paid"},ft={key:3,class:"total-row balance"},kt={class:"card"},gt={class:"card-header"},wt={key:0,class:"empty-state"},ht={key:1},xt={class:"actions-bar"},_t={class:"modal-header"},Ct={class:"modal-body"},Dt={class:"form-group"},Pt=["max"],It={class:"form-group"},St={class:"form-group"},Mt={class:"form-group"},Vt={class:"modal-footer"},zt={__name:"InvoiceDetail",setup(Ft){const m=E();G();const i=T(),o=x(null),C=x([]),y=x(!1),u=x({amount:0,method:"cash",reference:"",notes:""}),D=async()=>{try{const s=await f.getSale(m.params.id);o.value=s.data}catch(s){i.error("فشل تحميل الفاتورة"),console.error(s)}},I=async()=>{try{const s=await f.getPayments(m.params.id);C.value=s.data}catch(s){console.error("Failed to load payments:",s)}},z=async()=>{var s,e,v,b,l,h;if(!u.value.amount||u.value.amount<=0){i.error("الرجاء إدخال مبلغ صحيح");return}if(u.value.amount>o.value.balance_due){i.error("المبلغ أكبر من المتبقي");return}try{await f.recordPayment(m.params.id,u.value),i.success("تم تسجيل الدفعة بنجاح"),y.value=!1,u.value={amount:0,method:"cash",reference:"",notes:""},D(),I()}catch(c){console.error("Payment error:",c);const q=((e=(s=c.response)==null?void 0:s.data)==null?void 0:e.message)||((b=(v=c.response)==null?void 0:v.data)==null?void 0:b.error)||"فشل تسجيل الدفعة";i.error(q),(h=(l=c.response)==null?void 0:l.data)!=null&&h.details&&console.error("Error details:",c.response.data.details)}},F=async()=>{try{await f.downloadInvoicePdf(m.params.id),i.success("تم تحميل الفاتورة")}catch{i.error("فشل تحميل الفاتورة")}},$=async()=>{try{const s=await f.getWhatsAppMessage(m.params.id),{message:e,phone:v}=s.data;if(!v){i.error("لا يوجد رقم هاتف للعميل");return}const l=`https://wa.me/${v.replace(/[^0-9]/g,"")}?text=${encodeURIComponent(e)}`;window.open(l,"_blank"),i.success("تم فتح واتساب")}catch{i.error("فشل مشاركة الفاتورة")}},L=async()=>{if(confirm("هل أنت متأكد من إلغاء هذه الفاتورة؟ لا يمكن التراجع عن هذا الإجراء."))try{await f.voidSale(m.params.id),i.success("تم إلغاء الفاتورة"),D()}catch{i.error("فشل إلغاء الفاتورة")}},N=s=>new Date(s).toLocaleDateString("en-GB"),U=s=>new Date(s).toLocaleString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),d=s=>new Intl.NumberFormat("en-EG",{style:"currency",currency:"EGP",minimumFractionDigits:2}).format(s).replace(/[٠-٩]/g,e=>"٠١٢٣٤٥٦٧٨٩".indexOf(e)),B=s=>({draft:"مسودة",issued:"صادر",partially_paid:"مدفوع جزئياً",paid:"مدفوع",void:"ملغي"})[s]||s,R=s=>({cash:"نقدي",card:"بطاقة",bank:"تحويل بنكي",wallet:"محفظة إلكترونية",cod:"الدفع عند الاستلام"})[s]||s;return W(()=>{D(),I()}),(s,e)=>{var v,b;return o.value?(r(),a("div",tt,[t("div",et,[t("button",{onClick:e[0]||(e[0]=l=>s.$router.back()),class:"btn-back"},[k(w(Y),{size:20}),e[10]||(e[10]=g(" رجوع ",-1))]),t("h1",null,"فاتورة "+n(o.value.invoice_number),1),t("span",{class:X(["status-badge",o.value.status])},n(B(o.value.status)),3)]),t("div",lt,[t("div",st,[e[15]||(e[15]=t("h2",null,"معلومات الفاتورة",-1)),t("div",ot,[t("div",nt,[e[11]||(e[11]=t("label",null,"رقم الفاتورة:",-1)),t("span",null,n(o.value.invoice_number),1)]),t("div",at,[e[12]||(e[12]=t("label",null,"التاريخ:",-1)),t("span",null,n(N(o.value.issue_date||o.value.created_at)),1)]),t("div",rt,[e[13]||(e[13]=t("label",null,"العميل:",-1)),t("span",null,n(((v=o.value.customer)==null?void 0:v.name)||"عميل عادي"),1)]),t("div",ut,[e[14]||(e[14]=t("label",null,"الهاتف:",-1)),t("span",null,n(((b=o.value.customer)==null?void 0:b.phone)||"-"),1)])])]),t("div",it,[e[24]||(e[24]=t("h2",null,"المنتجات",-1)),t("table",null,[e[16]||(e[16]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"المنتج"),t("th",null,"الكمية"),t("th",null,"السعر"),t("th",null,"الإجمالي")])],-1)),t("tbody",null,[(r(!0),a(S,null,M(o.value.items,(l,h)=>{var c;return r(),a("tr",{key:l.id},[t("td",null,n(h+1),1),t("td",null,n((c=l.product)==null?void 0:c.name_ar),1),t("td",null,n(l.quantity),1),t("td",null,n(d(l.unit_price)),1),t("td",null,n(d(l.total_price)),1)])}),128))])]),t("div",dt,[t("div",vt,[e[17]||(e[17]=t("span",null,"المجموع الفرعي:",-1)),t("span",null,n(d(o.value.subtotal)),1)]),o.value.discount>0?(r(),a("div",ct,[e[18]||(e[18]=t("span",null,"الخصم:",-1)),t("span",null,"-"+n(d(o.value.discount)),1)])):p("",!0),o.value.tax>0?(r(),a("div",pt,[e[19]||(e[19]=t("span",null,"الضريبة:",-1)),t("span",null,n(d(o.value.tax)),1)])):p("",!0),o.value.shipping>0?(r(),a("div",mt,[e[20]||(e[20]=t("span",null,"الشحن:",-1)),t("span",null,n(d(o.value.shipping)),1)])):p("",!0),t("div",yt,[e[21]||(e[21]=t("span",null,"الإجمالي:",-1)),t("span",null,n(d(o.value.total)),1)]),t("div",bt,[e[22]||(e[22]=t("span",null,"المدفوع:",-1)),t("span",null,n(d(o.value.paid_sum)),1)]),o.value.balance_due>0?(r(),a("div",ft,[e[23]||(e[23]=t("span",null,"المتبقي:",-1)),t("span",null,n(d(o.value.balance_due)),1)])):p("",!0)])]),t("div",kt,[t("div",gt,[e[26]||(e[26]=t("h2",null,"المدفوعات",-1)),o.value.balance_due>0&&o.value.status!=="void"?(r(),a("button",{key:0,onClick:e[1]||(e[1]=l=>y.value=!0),class:"btn-primary"},[k(w(J),{size:18}),e[25]||(e[25]=g(" تسجيل دفعة ",-1))])):p("",!0)]),C.value.length===0?(r(),a("div",wt," لا توجد مدفوعات مسجلة ")):(r(),a("table",ht,[e[27]||(e[27]=t("thead",null,[t("tr",null,[t("th",null,"التاريخ"),t("th",null,"المبلغ"),t("th",null,"الطريقة"),t("th",null,"المرجع"),t("th",null,"الملاحظات")])],-1)),t("tbody",null,[(r(!0),a(S,null,M(C.value,l=>(r(),a("tr",{key:l.id},[t("td",null,n(U(l.paid_at)),1),t("td",null,n(d(l.amount)),1),t("td",null,n(R(l.method)),1),t("td",null,n(l.reference||"-"),1),t("td",null,n(l.notes||"-"),1)]))),128))])]))]),t("div",xt,[t("button",{onClick:F,class:"btn-primary"},[k(w(K),{size:18}),e[28]||(e[28]=g(" تحميل PDF ",-1))]),t("button",{onClick:$,class:"btn-success"},[k(w(Z),{size:18}),e[29]||(e[29]=g(" مشاركة واتساب ",-1))]),o.value.status!=="void"?(r(),a("button",{key:0,onClick:L,class:"btn-danger"},[k(w(Q),{size:18}),e[30]||(e[30]=g(" إلغاء الفاتورة ",-1))])):p("",!0)])]),y.value?(r(),a("div",{key:0,class:"modal-overlay",onClick:e[9]||(e[9]=l=>y.value=!1)},[t("div",{class:"modal",onClick:e[8]||(e[8]=H(()=>{},["stop"]))},[t("div",_t,[e[31]||(e[31]=t("h3",null,"تسجيل دفعة جديدة",-1)),t("button",{onClick:e[2]||(e[2]=l=>y.value=!1),class:"btn-close"},"×")]),t("div",Ct,[t("div",Dt,[e[32]||(e[32]=t("label",null,"المبلغ *",-1)),_(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>u.value.amount=l),type:"number",step:"0.01",max:o.value.balance_due,placeholder:"0.00"},null,8,Pt),[[P,u.value.amount,void 0,{number:!0}]]),t("small",null,"المتبقي: "+n(d(o.value.balance_due)),1)]),t("div",It,[e[34]||(e[34]=t("label",null,"طريقة الدفع *",-1)),_(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>u.value.method=l)},[...e[33]||(e[33]=[O('<option value="cash" data-v-6324879c>نقدي</option><option value="card" data-v-6324879c>بطاقة</option><option value="bank" data-v-6324879c>تحويل بنكي</option><option value="wallet" data-v-6324879c>محفظة إلكترونية</option><option value="cod" data-v-6324879c>الدفع عند الاستلام</option>',5)])],512),[[j,u.value.method]])]),t("div",St,[e[35]||(e[35]=t("label",null,"المرجع",-1)),_(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>u.value.reference=l),type:"text",placeholder:"رقم المعاملة أو المرجع"},null,512),[[P,u.value.reference]])]),t("div",Mt,[e[36]||(e[36]=t("label",null,"ملاحظات",-1)),_(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=l=>u.value.notes=l),rows:"3",placeholder:"ملاحظات إضافية"},null,512),[[P,u.value.notes]])])]),t("div",Vt,[t("button",{onClick:e[7]||(e[7]=l=>y.value=!1),class:"btn-secondary"},"إلغاء"),t("button",{onClick:z,class:"btn-primary"},"حفظ")])])])):p("",!0)])):p("",!0)}}},Bt=A(zt,[["__scopeId","data-v-6324879c"]]);export{Bt as default};
