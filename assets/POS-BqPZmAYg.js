import{b as it,r as l,g as U,h as ct,c as d,o as p,d as t,j as B,e as m,k as y,v as f,l as n,x as W,F as I,m as E,t as i,s as J,z as dt,B as pt,w as X,y as x}from"./index-BuCs9Ya6.js";import{f as S,t as o}from"./numbers-BTmV-EI5.js";import{c as F}from"./createLucideIcon-DwtPWXLV.js";import{P as vt}from"./package-CFKAbhjK.js";import{P as mt}from"./plus-B9av9HkW.js";import{T as yt}from"./trash-2-BRFYwYGb.js";import{U as bt}from"./user-plus-XKfi2-EU.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=F("MinusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=F("ScanIcon",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=F("SearchIcon",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=F("ShoppingCartIcon",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),ht={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},kt={class:"lg:col-span-2 space-y-4"},wt={class:"card"},Ct={class:"flex gap-3"},$t={class:"flex-1 relative"},qt={class:"grid grid-cols-2 md:grid-cols-3 gap-4"},Pt=["onClick"],Mt={class:"aspect-square bg-gray-100 rounded-lg mb-3 flex items-center justify-center"},zt={class:"font-bold text-gray-900 mb-1 truncate"},St={class:"text-sm text-gray-500 mb-2"},Vt={class:"flex items-center justify-between"},jt={class:"text-lg font-bold text-primary-600"},Ut={class:"space-y-4"},Bt={class:"card sticky top-24"},It={class:"text-xl font-bold mb-4 flex items-center gap-2"},Et={class:"space-y-3 mb-4 max-h-64 overflow-y-auto"},Ft={key:0,class:"text-center py-8 text-gray-500"},Dt={class:"flex-1"},Gt={class:"font-medium text-sm"},Tt={class:"text-xs text-gray-500"},Lt={class:"flex items-center gap-2"},Nt=["onClick"],At={class:"w-8 text-center font-bold"},Qt=["onClick"],Ht=["onClick"],Kt={class:"mb-4"},Ot={class:"flex gap-2"},Rt=["value"],Wt={class:"border-t pt-4 space-y-2"},Jt={class:"flex justify-between text-sm"},Xt={class:"font-bold"},Yt={class:"flex justify-between text-sm"},Zt={class:"flex justify-between text-sm"},te={class:"flex justify-between text-lg font-bold border-t pt-2"},ee={class:"text-primary-600"},se={class:"flex justify-between text-sm bg-blue-50 p-2 rounded"},ae=["placeholder"],ne={key:0,class:"flex justify-between text-sm text-red-600 font-bold"},oe={class:"mt-4"},le={class:"grid grid-cols-3 gap-2"},re=["onClick"],ue={class:"mt-4 space-y-2"},ie=["disabled"],ce={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},de={class:"bg-white rounded-xl p-6 w-full max-w-md"},pe={class:"flex gap-3"},ve={class:"bg-white rounded-xl p-6 w-full max-w-md"},me={class:"flex gap-3"},we={__name:"POS",setup(ye){const c=it(),C=l([]),$=l([]),r=l([]),b=l(""),q=l(""),g=l(0),_=l(0),P=l(null),D=l("cash"),V=l(!1),M=l(!1),h=l(""),T=l(null),k=l({name:"",phone:""}),Y=[{value:"cash",label:"ŸÜŸÇÿØŸä"},{value:"card",label:"ÿ®ÿ∑ÿßŸÇÿ©"},{value:"transfer",label:"ÿ™ÿ≠ŸàŸäŸÑ"}],Z=U(()=>b.value?C.value.filter(s=>s.name_ar.includes(b.value)||s.barcode.includes(b.value)):C.value.slice(0,12)),L=U(()=>r.value.reduce((s,e)=>s+e.product.selling_price*e.quantity,0)),z=U(()=>L.value+_.value-g.value),N=U(()=>{const s=P.value||z.value;return Math.max(0,z.value-s)}),tt=async()=>{if(b.value.length<2){G();return}try{const s=await x.getProducts({search:b.value});C.value=s.data}catch{c.error("ŸÅÿ¥ŸÑ ÿßŸÑÿ®ÿ≠ÿ´")}},et=()=>{V.value=!0,h.value="",setTimeout(()=>{var s;(s=T.value)==null||s.focus()},100)},A=async()=>{if(h.value)try{const s=await x.searchByBarcode(h.value);Q(s.data),V.value=!1,h.value=""}catch{c.error("ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ")}},Q=s=>{if(s.stock_quantity===0){c.error("ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ± ŸÅŸä ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ");return}const e=r.value.find(a=>a.product.id===s.id);if(e){if(e.quantity>=s.stock_quantity){c.error("ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±ÿ©");return}e.quantity++}else r.value.push({product:s,quantity:1});c.success("ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÑŸÑÿ≥ŸÑÿ©")},st=s=>{if(s.quantity>=s.product.stock_quantity){c.error("ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±ÿ©");return}s.quantity++},at=s=>{s.quantity>1?s.quantity--:H(s)},H=s=>{r.value=r.value.filter(e=>e.product.id!==s.product.id)},nt=()=>{r.value.length!==0&&confirm("ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ŸÑÿ©ÿü")&&(r.value=[],g.value=0,_.value=0)},ot=async()=>{try{const s=await x.createCustomer(k.value);c.success("ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿπŸÖŸäŸÑ ÿ®ŸÜÿ¨ÿßÿ≠"),$.value.push(s.data),q.value=s.data.id,M.value=!1,k.value={name:"",phone:""}}catch{c.error("ŸÅÿ¥ŸÑ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿπŸÖŸäŸÑ")}},lt=async()=>{var e,a,v;if(r.value.length===0)return;const s={customer_id:q.value||null,items:r.value.map(u=>({product_id:u.product.id,quantity:u.quantity,unit_price:u.product.selling_price})),tax:_.value,discount:g.value,paid_amount:P.value||z.value,payment_method:D.value};try{const u=await x.createSale(s),K=o(u.data.invoice_number);c.success(`ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© ${K}`);const O=[];if(confirm("ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© PDFÿü"))try{await x.downloadInvoicePdf(u.data.id),c.success("ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© ÿ®ŸÜÿ¨ÿßÿ≠")}catch(j){console.error("PDF Error:",j),c.error("ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© PDF")}(e=u.data.customer)!=null&&e.phone&&confirm("ŸáŸÑ ÿ™ÿ±ŸäÿØ ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© ÿπÿ®ÿ± Ÿàÿßÿ™ÿ≥ÿßÿ®ÿü")&&rt(u.data),r.value=[],g.value=0,_.value=0,P.value=null,q.value="",G()}catch(u){c.error(((v=(a=u.response)==null?void 0:a.data)==null?void 0:v.error)||"ŸÅÿ¥ŸÑ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ©")}},rt=s=>{var j;const e=$.value.find(w=>w.id===s.customer_id);if(!(e!=null&&e.phone))return;const a=((j=s.items)==null?void 0:j.map(w=>{var R;return`‚Ä¢ ${(R=w.product)==null?void 0:R.name_ar}: ${o(w.quantity)} √ó ${o(w.unit_price)} = ${o(w.total_price)} EGP`}).join("\\n"))||"",v=s.payment_status==="paid"?"ŸÖÿØŸÅŸàÿπ ÿ®ÿßŸÑŸÉÿßŸÖŸÑ ‚úÖ":s.payment_status==="partial"?"ŸÖÿØŸÅŸàÿπ ÿ¨ÿ≤ÿ¶ŸäÿßŸã ‚ö†Ô∏è":"ÿ∫Ÿäÿ± ŸÖÿØŸÅŸàÿπ ‚ùå",u=`üß¥ *ŸÅÿßÿ™Ÿàÿ±ÿ© ŸÖŸÜ ŸÖÿ™ÿ¨ÿ± ÿßŸÑÿπÿ∑Ÿàÿ±*\\n\\nüìã ÿ±ŸÇŸÖ ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ©: ${o(s.invoice_number)}\\nüìÖ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ: ${o(new Date(s.created_at).toLocaleDateString("en-GB"))}\\n\\n*ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™:*\\n${a}\\n\\nüí∞ ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÅÿ±ÿπŸä: ${o(s.subtotal)} EGP\\nüè∑Ô∏è ÿßŸÑÿÆÿµŸÖ: ${o(s.discount)} EGP\\nüìä ÿßŸÑÿ∂ÿ±Ÿäÿ®ÿ©: ${o(s.tax)} EGP\\n*üíµ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä: ${o(s.total)} EGP*\\n\\n‚úÖ ÿßŸÑŸÖÿØŸÅŸàÿπ: ${o(s.paid_amount||s.total)} EGP\\n${s.remaining_amount>0?`‚ö†Ô∏è ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: ${o(s.remaining_amount)} EGP\\n`:""}\\nüìå ÿ≠ÿßŸÑÿ© ÿßŸÑÿØŸÅÿπ: ${v}\\n\\nÿ¥ŸÉÿ±ÿßŸã ŸÑÿ™ÿπÿßŸÖŸÑŸÉŸÖ ŸÖÿπŸÜÿß üåπ`,O=`https://wa.me/${e.phone.replace(/[^0-9]/g,"")}?text=${encodeURIComponent(u)}`;window.open(O,"_blank")},G=async()=>{try{const s=await x.getProducts();C.value=s.data.data||s.data||[]}catch(s){console.error("Failed to load products:",s),C.value=[]}},ut=async()=>{try{const s=await x.getCustomers();$.value=s.data.data||s.data||[]}catch(s){console.error("Failed to load customers:",s),$.value=[]}};return ct(()=>{G(),ut()}),(s,e)=>(p(),d("div",ht,[t("div",kt,[t("div",wt,[t("div",Ct,[t("div",$t,[m(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),onInput:tt,type:"text",placeholder:"ÿßÿ®ÿ≠ÿ´ ÿ®ÿßŸÑÿßÿ≥ŸÖ ÿ£Ÿà ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ...",class:"input pl-10"},null,544),[[f,b.value]]),y(n(gt),{class:"absolute left-3 top-3 text-gray-400",size:20})]),t("button",{onClick:et,class:"btn btn-primary flex items-center gap-2"},[y(n(xt),{size:20}),e[12]||(e[12]=W(" ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ ",-1))])])]),t("div",qt,[(p(!0),d(I,null,E(Z.value,a=>{var v;return p(),d("div",{key:a.id,onClick:u=>Q(a),class:"card hover:shadow-lg cursor-pointer transition-all hover:scale-105"},[t("div",Mt,[y(n(vt),{size:48,class:"text-gray-400"})]),t("h4",zt,i(a.name_ar),1),t("p",St,i((v=a.brand)==null?void 0:v.name_ar),1),t("div",Vt,[t("span",jt,i(n(S)(a.selling_price)),1),t("span",{class:J(["text-xs badge",a.stock_quantity>0?"badge-success":"badge-danger"])},i(n(o)(a.stock_quantity))+" ŸÇÿ∑ÿπÿ© ",3)])],8,Pt)}),128))])]),t("div",Ut,[t("div",Bt,[t("h3",It,[y(n(_t),{size:24}),e[13]||(e[13]=W(" ÿ≥ŸÑÿ© ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿäÿßÿ™ ",-1))]),t("div",Et,[r.value.length===0?(p(),d("div",Ft," ÿßŸÑÿ≥ŸÑÿ© ŸÅÿßÿ±ÿ∫ÿ© ")):B("",!0),(p(!0),d(I,null,E(r.value,a=>(p(),d("div",{key:a.product.id,class:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg"},[t("div",Dt,[t("p",Gt,i(a.product.name_ar),1),t("p",Tt,i(n(S)(a.product.selling_price)),1)]),t("div",Lt,[t("button",{onClick:v=>at(a),class:"w-7 h-7 rounded bg-gray-200 hover:bg-gray-300"},[y(n(ft),{size:16,class:"mx-auto"})],8,Nt),t("span",At,i(n(o)(a.quantity)),1),t("button",{onClick:v=>st(a),class:"w-7 h-7 rounded bg-gray-200 hover:bg-gray-300"},[y(n(mt),{size:16,class:"mx-auto"})],8,Qt)]),t("button",{onClick:v=>H(a),class:"text-red-600 hover:text-red-800"},[y(n(yt),{size:18})],8,Ht)]))),128))]),t("div",Kt,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium mb-2"},"ÿßŸÑÿπŸÖŸäŸÑ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)",-1)),t("div",Ot,[m(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>q.value=a),class:"input flex-1"},[e[14]||(e[14]=t("option",{value:""},"ÿπŸÖŸäŸÑ ÿπÿßÿØŸä",-1)),(p(!0),d(I,null,E($.value,a=>(p(),d("option",{key:a.id,value:a.id},i(a.name)+" - "+i(n(o)(a.phone)),9,Rt))),128))],512),[[dt,q.value]]),t("button",{onClick:e[2]||(e[2]=a=>M.value=!0),class:"btn btn-secondary"},[y(n(bt),{size:18})])])]),t("div",Wt,[t("div",Jt,[e[16]||(e[16]=t("span",null,"ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÅÿ±ÿπŸä:",-1)),t("span",Xt,i(n(S)(L.value)),1)]),t("div",Yt,[e[17]||(e[17]=t("span",null,"ÿßŸÑÿÆÿµŸÖ:",-1)),m(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>g.value=a),type:"number",step:"0.01",class:"input w-32 text-left py-1"},null,512),[[f,g.value,void 0,{number:!0}]])]),t("div",Zt,[e[18]||(e[18]=t("span",null,"ÿßŸÑÿ∂ÿ±Ÿäÿ®ÿ©:",-1)),m(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>_.value=a),type:"number",step:"0.01",class:"input w-32 text-left py-1"},null,512),[[f,_.value,void 0,{number:!0}]])]),t("div",te,[e[19]||(e[19]=t("span",null,"ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä:",-1)),t("span",ee,i(n(S)(z.value)),1)]),t("div",se,[e[20]||(e[20]=t("span",null,"ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿØŸÅŸàÿπ:",-1)),m(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>P.value=a),type:"number",step:"0.01",placeholder:z.value.toString(),class:"input w-32 text-left py-1"},null,8,ae),[[f,P.value,void 0,{number:!0}]])]),N.value>0?(p(),d("div",ne,[e[21]||(e[21]=t("span",null,"ÿßŸÑŸÖÿ™ÿ®ŸÇŸä:",-1)),t("span",null,i(n(S)(N.value)),1)])):B("",!0)]),t("div",oe,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium mb-2"},"ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ",-1)),t("div",le,[(p(),d(I,null,E(Y,a=>t("button",{key:a.value,onClick:v=>D.value=a.value,class:J([D.value===a.value?"bg-primary-600 text-white":"bg-gray-100","py-2 rounded-lg font-medium transition-all"])},i(a.label),11,re)),64))])]),t("div",ue,[t("button",{onClick:lt,disabled:r.value.length===0,class:"btn btn-success w-full py-3 text-lg"}," ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ®Ÿäÿπ ",8,ie),t("button",{onClick:nt,class:"btn btn-secondary w-full"}," ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ŸÑÿ© ")])])]),V.value?(p(),d("div",ce,[t("div",de,[e[23]||(e[23]=t("h3",{class:"text-2xl font-bold mb-4"},"ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ",-1)),m(t("input",{ref_key:"barcodeInput",ref:T,"onUpdate:modelValue":e[6]||(e[6]=a=>h.value=a),onKeyup:pt(A,["enter"]),type:"text",placeholder:"ÿßŸÖÿ≥ÿ≠ ÿ£Ÿà ÿßŸÉÿ™ÿ® ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ...",class:"input mb-4",autofocus:""},null,544),[[f,h.value]]),t("div",pe,[t("button",{onClick:e[7]||(e[7]=a=>V.value=!1),class:"btn btn-secondary flex-1"},"ÿ•ŸÑÿ∫ÿßÿ°"),t("button",{onClick:A,class:"btn btn-primary flex-1"},"ÿ®ÿ≠ÿ´")])])])):B("",!0),M.value?(p(),d("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e[11]||(e[11]=X(a=>M.value=!1,["self"]))},[t("div",ve,[e[27]||(e[27]=t("h3",{class:"text-2xl font-bold mb-4"},"ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÖŸäŸÑ",-1)),t("form",{onSubmit:X(ot,["prevent"]),class:"space-y-4"},[t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium mb-2"},"ÿßŸÑÿßÿ≥ŸÖ *",-1)),m(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>k.value.name=a),type:"text",required:"",class:"input"},null,512),[[f,k.value.name]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium mb-2"},"ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ *",-1)),m(t("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>k.value.phone=a),type:"tel",required:"",class:"input"},null,512),[[f,k.value.phone]])]),t("div",me,[t("button",{type:"button",onClick:e[10]||(e[10]=a=>M.value=!1),class:"btn btn-secondary flex-1"},"ÿ•ŸÑÿ∫ÿßÿ°"),e[26]||(e[26]=t("button",{type:"submit",class:"btn btn-primary flex-1"},"ÿ≠ŸÅÿ∏",-1))])],32)])])):B("",!0)]))}};export{we as default};
