import{b as ue,r,g as j,h as ie,c,o as d,d as e,j as S,e as v,k as m,v as b,l as o,x as O,F as U,m as $,t as i,s as R,z as ce,B as de,w as G,y}from"./index-Bk0TT-D-.js";import{f as P,t as I}from"./numbers-BTmV-EI5.js";import{c as B}from"./createLucideIcon-H2N9mmqx.js";import{P as pe}from"./package-Bhv_xrrm.js";import{P as ve}from"./plus-C2WuK_Gq.js";import{T as me}from"./trash-2-DR0rpH1P.js";import{U as ye}from"./user-plus-B5o4FHQR.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=B("MinusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=B("ScanIcon",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=B("SearchIcon",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=B("ShoppingCartIcon",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),he={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},_e={class:"lg:col-span-2 space-y-4"},ke={class:"card"},we={class:"flex gap-3"},Ce={class:"flex-1 relative"},qe={class:"grid grid-cols-2 md:grid-cols-3 gap-4"},Me=["onClick"],Pe={class:"aspect-square bg-gray-100 rounded-lg mb-3 flex items-center justify-center"},ze={class:"font-bold text-gray-900 mb-1 truncate"},Ve={class:"text-sm text-gray-500 mb-2"},je={class:"flex items-center justify-between"},Se={class:"text-lg font-bold text-primary-600"},Ue={class:"space-y-4"},$e={class:"card sticky top-24"},Ie={class:"text-xl font-bold mb-4 flex items-center gap-2"},Be={class:"space-y-3 mb-4 max-h-64 overflow-y-auto"},Fe={key:0,class:"text-center py-8 text-gray-500"},Te={class:"flex-1"},De={class:"font-medium text-sm"},Ne={class:"text-xs text-gray-500"},Ae={class:"flex items-center gap-2"},Le=["onClick"],Ee={class:"w-8 text-center font-bold"},Qe=["onClick"],We=["onClick"],He={class:"mb-4"},Ke={class:"flex gap-2"},Oe=["value"],Re={class:"border-t pt-4 space-y-2"},Ge={class:"flex justify-between text-sm"},Je={class:"font-bold"},Xe={class:"flex justify-between text-sm"},Ye={class:"flex justify-between text-sm"},Ze={class:"flex justify-between text-lg font-bold border-t pt-2"},et={class:"text-primary-600"},tt={class:"flex justify-between text-sm bg-blue-50 p-2 rounded"},st=["placeholder"],at={key:0,class:"flex justify-between text-sm text-red-600 font-bold"},ot={class:"mt-4"},nt={class:"grid grid-cols-3 gap-2"},lt=["onClick"],rt={class:"mt-4 space-y-2"},ut=["disabled"],it={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ct={class:"bg-white rounded-xl p-6 w-full max-w-md"},dt={class:"flex gap-3"},pt={class:"bg-white rounded-xl p-6 w-full max-w-md"},vt={class:"flex gap-3"},kt={__name:"POS",setup(mt){const n=ue(),k=r([]),z=r([]),u=r([]),f=r(""),w=r(""),x=r(0),g=r(0),C=r(null),F=r("cash"),V=r(!1),q=r(!1),h=r(""),A=r(null),_=r({name:"",phone:""}),J=[{value:"cash",label:"ŸÜŸÇÿØŸä"},{value:"card",label:"ÿ®ÿ∑ÿßŸÇÿ©"},{value:"transfer",label:"ÿ™ÿ≠ŸàŸäŸÑ"}],X=j(()=>f.value?k.value.filter(a=>a.name_ar.includes(f.value)||a.barcode.includes(f.value)):k.value.slice(0,12)),L=j(()=>u.value.reduce((a,t)=>a+t.product.selling_price*t.quantity,0)),M=j(()=>L.value+g.value-x.value),E=j(()=>{const a=C.value||M.value;return Math.max(0,M.value-a)}),Y=async()=>{if(f.value.length<2){T();return}try{const a=await y.getProducts({search:f.value});k.value=a.data}catch{n.error("ŸÅÿ¥ŸÑ ÿßŸÑÿ®ÿ≠ÿ´")}},Z=()=>{V.value=!0,h.value="",setTimeout(()=>{var a;(a=A.value)==null||a.focus()},100)},Q=async()=>{if(h.value)try{const a=await y.searchByBarcode(h.value);W(a.data),V.value=!1,h.value=""}catch{n.error("ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ")}},W=a=>{if(a.stock_quantity===0){n.error("ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ± ŸÅŸä ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ");return}const t=u.value.find(s=>s.product.id===a.id);if(t){if(t.quantity>=a.stock_quantity){n.error("ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±ÿ©");return}t.quantity++}else u.value.push({product:a,quantity:1});n.success("ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÑŸÑÿ≥ŸÑÿ©")},ee=a=>{if(a.quantity>=a.product.stock_quantity){n.error("ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ© ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±ÿ©");return}a.quantity++},te=a=>{a.quantity>1?a.quantity--:H(a)},H=a=>{u.value=u.value.filter(t=>t.product.id!==a.product.id)},se=()=>{u.value.length!==0&&confirm("ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ŸÑÿ©ÿü")&&(u.value=[],x.value=0,g.value=0)},ae=async()=>{try{const a=await y.createCustomer(_.value);n.success("ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿπŸÖŸäŸÑ ÿ®ŸÜÿ¨ÿßÿ≠"),z.value.push(a.data),w.value=a.data.id,q.value=!1,_.value={name:"",phone:""}}catch{n.error("ŸÅÿ¥ŸÑ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿπŸÖŸäŸÑ")}},oe=async()=>{var t,s,p;if(u.value.length===0)return;const a={customer_id:w.value||null,items:u.value.map(l=>({product_id:l.product.id,quantity:l.quantity,unit_price:l.product.selling_price})),tax:g.value,discount:x.value,paid_amount:C.value||M.value,payment_method:F.value};try{const l=await y.createSale(a),D=I(l.data.invoice_number);n.success(`ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© ${D}`);const K=[];if(confirm("ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© PDFÿü"))try{await y.downloadInvoicePdf(l.data.id),n.success("ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© ÿ®ŸÜÿ¨ÿßÿ≠")}catch(N){console.error("PDF Error:",N),n.error("ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© PDF")}(t=l.data.customer)!=null&&t.phone&&confirm("ŸáŸÑ ÿ™ÿ±ŸäÿØ ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© ÿπÿ®ÿ± Ÿàÿßÿ™ÿ≥ÿßÿ®ÿü")&&ne(l.data),u.value=[],x.value=0,g.value=0,C.value=null,w.value="",T()}catch(l){n.error(((p=(s=l.response)==null?void 0:s.data)==null?void 0:p.error)||"ŸÅÿ¥ŸÑ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ©")}},ne=async a=>{try{const t=await y.getWhatsAppMessage(a.id),{message:s,pdf_url:p,phone:l}=t.data;if(!l){n.error("ŸÑÿß ŸäŸàÿ¨ÿØ ÿ±ŸÇŸÖ Ÿáÿßÿ™ŸÅ ŸÑŸÑÿπŸÖŸäŸÑ");return}const D=l.replace(/[^0-9]/g,""),K=`

`+"=".repeat(25)+`
üìÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© PDF:
`+p+`
`+"=".repeat(25),N=s+K,re=`https://wa.me/${D}?text=${encodeURIComponent(N)}`;window.open(re,"_blank"),n.success("ÿ™ŸÖ ŸÅÿ™ÿ≠ Ÿàÿßÿ™ÿ≥ÿßÿ® ÿ®ŸÜÿ¨ÿßÿ≠")}catch(t){console.error("WhatsApp Error:",t),n.error("ŸÅÿ¥ŸÑ ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© ÿπÿ®ÿ± Ÿàÿßÿ™ÿ≥ÿßÿ®")}},T=async()=>{try{const a=await y.getProducts();k.value=a.data.data||a.data||[]}catch(a){console.error("Failed to load products:",a),k.value=[]}},le=async()=>{try{const a=await y.getCustomers();z.value=a.data.data||a.data||[]}catch(a){console.error("Failed to load customers:",a),z.value=[]}};return ie(()=>{T(),le()}),(a,t)=>(d(),c("div",he,[e("div",_e,[e("div",ke,[e("div",we,[e("div",Ce,[v(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>f.value=s),onInput:Y,type:"text",placeholder:"ÿßÿ®ÿ≠ÿ´ ÿ®ÿßŸÑÿßÿ≥ŸÖ ÿ£Ÿà ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ...",class:"input pl-10"},null,544),[[b,f.value]]),m(o(xe),{class:"absolute left-3 top-3 text-gray-400",size:20})]),e("button",{onClick:Z,class:"btn btn-primary flex items-center gap-2"},[m(o(be),{size:20}),t[12]||(t[12]=O(" ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ ",-1))])])]),e("div",qe,[(d(!0),c(U,null,$(X.value,s=>{var p;return d(),c("div",{key:s.id,onClick:l=>W(s),class:"card hover:shadow-lg cursor-pointer transition-all hover:scale-105"},[e("div",Pe,[m(o(pe),{size:48,class:"text-gray-400"})]),e("h4",ze,i(s.name_ar),1),e("p",Ve,i((p=s.brand)==null?void 0:p.name_ar),1),e("div",je,[e("span",Se,i(o(P)(s.selling_price)),1),e("span",{class:R(["text-xs badge",s.stock_quantity>0?"badge-success":"badge-danger"])},i(o(I)(s.stock_quantity))+" ŸÇÿ∑ÿπÿ© ",3)])],8,Me)}),128))])]),e("div",Ue,[e("div",$e,[e("h3",Ie,[m(o(ge),{size:24}),t[13]||(t[13]=O(" ÿ≥ŸÑÿ© ÿßŸÑŸÖÿ¥ÿ™ÿ±Ÿäÿßÿ™ ",-1))]),e("div",Be,[u.value.length===0?(d(),c("div",Fe," ÿßŸÑÿ≥ŸÑÿ© ŸÅÿßÿ±ÿ∫ÿ© ")):S("",!0),(d(!0),c(U,null,$(u.value,s=>(d(),c("div",{key:s.product.id,class:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg"},[e("div",Te,[e("p",De,i(s.product.name_ar),1),e("p",Ne,i(o(P)(s.product.selling_price)),1)]),e("div",Ae,[e("button",{onClick:p=>te(s),class:"w-7 h-7 rounded bg-gray-200 hover:bg-gray-300"},[m(o(fe),{size:16,class:"mx-auto"})],8,Le),e("span",Ee,i(o(I)(s.quantity)),1),e("button",{onClick:p=>ee(s),class:"w-7 h-7 rounded bg-gray-200 hover:bg-gray-300"},[m(o(ve),{size:16,class:"mx-auto"})],8,Qe)]),e("button",{onClick:p=>H(s),class:"text-red-600 hover:text-red-800"},[m(o(me),{size:18})],8,We)]))),128))]),e("div",He,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium mb-2"},"ÿßŸÑÿπŸÖŸäŸÑ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)",-1)),e("div",Ke,[v(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>w.value=s),class:"input flex-1"},[t[14]||(t[14]=e("option",{value:""},"ÿπŸÖŸäŸÑ ÿπÿßÿØŸä",-1)),(d(!0),c(U,null,$(z.value,s=>(d(),c("option",{key:s.id,value:s.id},i(s.name)+" - "+i(o(I)(s.phone)),9,Oe))),128))],512),[[ce,w.value]]),e("button",{onClick:t[2]||(t[2]=s=>q.value=!0),class:"btn btn-secondary"},[m(o(ye),{size:18})])])]),e("div",Re,[e("div",Ge,[t[16]||(t[16]=e("span",null,"ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÅÿ±ÿπŸä:",-1)),e("span",Je,i(o(P)(L.value)),1)]),e("div",Xe,[t[17]||(t[17]=e("span",null,"ÿßŸÑÿÆÿµŸÖ:",-1)),v(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>x.value=s),type:"number",step:"0.01",class:"input w-32 text-left py-1"},null,512),[[b,x.value,void 0,{number:!0}]])]),e("div",Ye,[t[18]||(t[18]=e("span",null,"ÿßŸÑÿ∂ÿ±Ÿäÿ®ÿ©:",-1)),v(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>g.value=s),type:"number",step:"0.01",class:"input w-32 text-left py-1"},null,512),[[b,g.value,void 0,{number:!0}]])]),e("div",Ze,[t[19]||(t[19]=e("span",null,"ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä:",-1)),e("span",et,i(o(P)(M.value)),1)]),e("div",tt,[t[20]||(t[20]=e("span",null,"ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿØŸÅŸàÿπ:",-1)),v(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>C.value=s),type:"number",step:"0.01",placeholder:M.value.toString(),class:"input w-32 text-left py-1"},null,8,st),[[b,C.value,void 0,{number:!0}]])]),E.value>0?(d(),c("div",at,[t[21]||(t[21]=e("span",null,"ÿßŸÑŸÖÿ™ÿ®ŸÇŸä:",-1)),e("span",null,i(o(P)(E.value)),1)])):S("",!0)]),e("div",ot,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium mb-2"},"ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ",-1)),e("div",nt,[(d(),c(U,null,$(J,s=>e("button",{key:s.value,onClick:p=>F.value=s.value,class:R([F.value===s.value?"bg-primary-600 text-white":"bg-gray-100","py-2 rounded-lg font-medium transition-all"])},i(s.label),11,lt)),64))])]),e("div",rt,[e("button",{onClick:oe,disabled:u.value.length===0,class:"btn btn-success w-full py-3 text-lg"}," ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ®Ÿäÿπ ",8,ut),e("button",{onClick:se,class:"btn btn-secondary w-full"}," ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ŸÑÿ© ")])])]),V.value?(d(),c("div",it,[e("div",ct,[t[23]||(t[23]=e("h3",{class:"text-2xl font-bold mb-4"},"ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ",-1)),v(e("input",{ref_key:"barcodeInput",ref:A,"onUpdate:modelValue":t[6]||(t[6]=s=>h.value=s),onKeyup:de(Q,["enter"]),type:"text",placeholder:"ÿßŸÖÿ≥ÿ≠ ÿ£Ÿà ÿßŸÉÿ™ÿ® ÿßŸÑÿ®ÿßÿ±ŸÉŸàÿØ...",class:"input mb-4",autofocus:""},null,544),[[b,h.value]]),e("div",dt,[e("button",{onClick:t[7]||(t[7]=s=>V.value=!1),class:"btn btn-secondary flex-1"},"ÿ•ŸÑÿ∫ÿßÿ°"),e("button",{onClick:Q,class:"btn btn-primary flex-1"},"ÿ®ÿ≠ÿ´")])])])):S("",!0),q.value?(d(),c("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t[11]||(t[11]=G(s=>q.value=!1,["self"]))},[e("div",pt,[t[27]||(t[27]=e("h3",{class:"text-2xl font-bold mb-4"},"ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÖŸäŸÑ",-1)),e("form",{onSubmit:G(ae,["prevent"]),class:"space-y-4"},[e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium mb-2"},"ÿßŸÑÿßÿ≥ŸÖ *",-1)),v(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>_.value.name=s),type:"text",required:"",class:"input"},null,512),[[b,_.value.name]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium mb-2"},"ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ *",-1)),v(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>_.value.phone=s),type:"tel",required:"",class:"input"},null,512),[[b,_.value.phone]])]),e("div",vt,[e("button",{type:"button",onClick:t[10]||(t[10]=s=>q.value=!1),class:"btn btn-secondary flex-1"},"ÿ•ŸÑÿ∫ÿßÿ°"),t[26]||(t[26]=e("button",{type:"submit",class:"btn btn-primary flex-1"},"ÿ≠ŸÅÿ∏",-1))])],32)])])):S("",!0)]))}};export{kt as default};
