import{b as re,r,g as j,h as ue,c,o as d,d as e,j as S,e as v,k as m,v as f,l as o,x as O,F as U,m as $,t as i,s as R,z as ie,B as ce,w as G,y}from"./index-Do8Q36UZ.js";import{f as P,t as I}from"./numbers-BTmV-EI5.js";import{c as B}from"./createLucideIcon-CP6pKSB9.js";import{P as de}from"./package-JUg8V7FK.js";import{P as pe}from"./plus-BCQUGUPf.js";import{T as ve}from"./trash-2-ChhYeTpd.js";import{U as me}from"./user-plus-BcHLNKT2.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=B("MinusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=B("ScanIcon",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=B("SearchIcon",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=B("ShoppingCartIcon",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),ge={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},he={class:"lg:col-span-2 space-y-4"},_e={class:"card"},ke={class:"flex gap-3"},we={class:"flex-1 relative"},Ce={class:"grid grid-cols-2 md:grid-cols-3 gap-4"},qe=["onClick"],Me={class:"aspect-square bg-gray-100 rounded-lg mb-3 flex items-center justify-center"},Pe={class:"font-bold text-gray-900 mb-1 truncate"},ze={class:"text-sm text-gray-500 mb-2"},Ve={class:"flex items-center justify-between"},je={class:"text-lg font-bold text-primary-600"},Se={class:"space-y-4"},Ue={class:"card sticky top-24"},$e={class:"text-xl font-bold mb-4 flex items-center gap-2"},Ie={class:"space-y-3 mb-4 max-h-64 overflow-y-auto"},Be={key:0,class:"text-center py-8 text-gray-500"},Fe={class:"flex-1"},De={class:"font-medium text-sm"},Te={class:"text-xs text-gray-500"},Ne={class:"flex items-center gap-2"},Ae=["onClick"],Le={class:"w-8 text-center font-bold"},Ee=["onClick"],Qe=["onClick"],We={class:"mb-4"},He={class:"flex gap-2"},Ke=["value"],Oe={class:"border-t pt-4 space-y-2"},Re={class:"flex justify-between text-sm"},Ge={class:"font-bold"},Je={class:"flex justify-between text-sm"},Xe={class:"flex justify-between text-sm"},Ye={class:"flex justify-between text-lg font-bold border-t pt-2"},Ze={class:"text-primary-600"},et={class:"flex justify-between text-sm bg-blue-50 p-2 rounded"},tt=["placeholder"],st={key:0,class:"flex justify-between text-sm text-red-600 font-bold"},at={class:"mt-4"},ot={class:"grid grid-cols-3 gap-2"},lt=["onClick"],nt={class:"mt-4 space-y-2"},rt=["disabled"],ut={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},it={class:"bg-white rounded-xl p-6 w-full max-w-md"},ct={class:"flex gap-3"},dt={class:"bg-white rounded-xl p-6 w-full max-w-md"},pt={class:"flex gap-3"},_t={__name:"POS",setup(vt){const l=re(),k=r([]),z=r([]),u=r([]),b=r(""),w=r(""),x=r(0),g=r(0),C=r(null),F=r("cash"),V=r(!1),q=r(!1),h=r(""),A=r(null),_=r({name:"",phone:""}),J=[{value:"cash",label:"نقدي"},{value:"card",label:"بطاقة"},{value:"transfer",label:"تحويل"}],X=j(()=>b.value?k.value.filter(a=>a.name_ar.includes(b.value)||a.barcode.includes(b.value)):k.value.slice(0,12)),L=j(()=>u.value.reduce((a,t)=>a+t.product.selling_price*t.quantity,0)),M=j(()=>L.value+g.value-x.value),E=j(()=>{const a=C.value||M.value;return Math.max(0,M.value-a)}),Y=async()=>{if(b.value.length<2){D();return}try{const a=await y.getProducts({search:b.value});k.value=a.data}catch{l.error("فشل البحث")}},Z=()=>{V.value=!0,h.value="",setTimeout(()=>{var a;(a=A.value)==null||a.focus()},100)},Q=async()=>{if(h.value)try{const a=await y.searchByBarcode(h.value);W(a.data),V.value=!1,h.value=""}catch{l.error("المنتج غير موجود")}},W=a=>{if(a.stock_quantity===0){l.error("المنتج غير متوفر في المخزون");return}const t=u.value.find(s=>s.product.id===a.id);if(t){if(t.quantity>=a.stock_quantity){l.error("الكمية المطلوبة غير متوفرة");return}t.quantity++}else u.value.push({product:a,quantity:1});l.success("تم إضافة المنتج للسلة")},ee=a=>{if(a.quantity>=a.product.stock_quantity){l.error("الكمية المطلوبة غير متوفرة");return}a.quantity++},te=a=>{a.quantity>1?a.quantity--:H(a)},H=a=>{u.value=u.value.filter(t=>t.product.id!==a.product.id)},se=()=>{u.value.length!==0&&confirm("هل أنت متأكد من مسح السلة؟")&&(u.value=[],x.value=0,g.value=0)},ae=async()=>{try{const a=await y.createCustomer(_.value);l.success("تم إضافة العميل بنجاح"),z.value.push(a.data),w.value=a.data.id,q.value=!1,_.value={name:"",phone:""}}catch{l.error("فشل إضافة العميل")}},oe=async()=>{var t,s,p;if(u.value.length===0)return;const a={customer_id:w.value||null,items:u.value.map(n=>({product_id:n.product.id,quantity:n.quantity,unit_price:n.product.selling_price})),tax:g.value,discount:x.value,paid_amount:C.value||M.value,payment_method:F.value};try{const n=await y.createSale(a),T=I(n.data.invoice_number);l.success(`تم إنشاء الفاتورة ${T}`);const K=[];if(confirm("هل تريد تحميل الفاتورة PDF؟"))try{await y.downloadInvoicePdf(n.data.id),l.success("تم تحميل الفاتورة بنجاح")}catch(N){console.error("PDF Error:",N),l.error("فشل تحميل الفاتورة PDF")}(t=n.data.customer)!=null&&t.phone&&confirm("هل تريد مشاركة الفاتورة عبر واتساب؟")&&le(n.data),u.value=[],x.value=0,g.value=0,C.value=null,w.value="",D()}catch(n){l.error(((p=(s=n.response)==null?void 0:s.data)==null?void 0:p.error)||"فشل إنشاء الفاتورة")}},le=async a=>{try{const t=await y.getWhatsAppMessage(a.id),{message:s,pdf_url:p,phone:n}=t.data;if(!n){l.error("لا يوجد رقم هاتف للعميل");return}const T=n.replace(/[^0-9]/g,""),K=s+`

رابط الفاتورة PDF:
`+p,N=`https://wa.me/${T}?text=${encodeURIComponent(K)}`;window.open(N,"_blank"),l.success("تم فتح واتساب بنجاح")}catch(t){console.error("WhatsApp Error:",t),l.error("فشل مشاركة الفاتورة عبر واتساب")}},D=async()=>{try{const a=await y.getProducts();k.value=a.data.data||a.data||[]}catch(a){console.error("Failed to load products:",a),k.value=[]}},ne=async()=>{try{const a=await y.getCustomers();z.value=a.data.data||a.data||[]}catch(a){console.error("Failed to load customers:",a),z.value=[]}};return ue(()=>{D(),ne()}),(a,t)=>(d(),c("div",ge,[e("div",he,[e("div",_e,[e("div",ke,[e("div",we,[v(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>b.value=s),onInput:Y,type:"text",placeholder:"ابحث بالاسم أو الباركود...",class:"input pl-10"},null,544),[[f,b.value]]),m(o(fe),{class:"absolute left-3 top-3 text-gray-400",size:20})]),e("button",{onClick:Z,class:"btn btn-primary flex items-center gap-2"},[m(o(be),{size:20}),t[12]||(t[12]=O(" مسح الباركود ",-1))])])]),e("div",Ce,[(d(!0),c(U,null,$(X.value,s=>{var p;return d(),c("div",{key:s.id,onClick:n=>W(s),class:"card hover:shadow-lg cursor-pointer transition-all hover:scale-105"},[e("div",Me,[m(o(de),{size:48,class:"text-gray-400"})]),e("h4",Pe,i(s.name_ar),1),e("p",ze,i((p=s.brand)==null?void 0:p.name_ar),1),e("div",Ve,[e("span",je,i(o(P)(s.selling_price)),1),e("span",{class:R(["text-xs badge",s.stock_quantity>0?"badge-success":"badge-danger"])},i(o(I)(s.stock_quantity))+" قطعة ",3)])],8,qe)}),128))])]),e("div",Se,[e("div",Ue,[e("h3",$e,[m(o(xe),{size:24}),t[13]||(t[13]=O(" سلة المشتريات ",-1))]),e("div",Ie,[u.value.length===0?(d(),c("div",Be," السلة فارغة ")):S("",!0),(d(!0),c(U,null,$(u.value,s=>(d(),c("div",{key:s.product.id,class:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg"},[e("div",Fe,[e("p",De,i(s.product.name_ar),1),e("p",Te,i(o(P)(s.product.selling_price)),1)]),e("div",Ne,[e("button",{onClick:p=>te(s),class:"w-7 h-7 rounded bg-gray-200 hover:bg-gray-300"},[m(o(ye),{size:16,class:"mx-auto"})],8,Ae),e("span",Le,i(o(I)(s.quantity)),1),e("button",{onClick:p=>ee(s),class:"w-7 h-7 rounded bg-gray-200 hover:bg-gray-300"},[m(o(pe),{size:16,class:"mx-auto"})],8,Ee)]),e("button",{onClick:p=>H(s),class:"text-red-600 hover:text-red-800"},[m(o(ve),{size:18})],8,Qe)]))),128))]),e("div",We,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium mb-2"},"العميل (اختياري)",-1)),e("div",He,[v(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>w.value=s),class:"input flex-1"},[t[14]||(t[14]=e("option",{value:""},"عميل عادي",-1)),(d(!0),c(U,null,$(z.value,s=>(d(),c("option",{key:s.id,value:s.id},i(s.name)+" - "+i(o(I)(s.phone)),9,Ke))),128))],512),[[ie,w.value]]),e("button",{onClick:t[2]||(t[2]=s=>q.value=!0),class:"btn btn-secondary"},[m(o(me),{size:18})])])]),e("div",Oe,[e("div",Re,[t[16]||(t[16]=e("span",null,"المجموع الفرعي:",-1)),e("span",Ge,i(o(P)(L.value)),1)]),e("div",Je,[t[17]||(t[17]=e("span",null,"الخصم:",-1)),v(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>x.value=s),type:"number",step:"0.01",class:"input w-32 text-left py-1"},null,512),[[f,x.value,void 0,{number:!0}]])]),e("div",Xe,[t[18]||(t[18]=e("span",null,"الضريبة:",-1)),v(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>g.value=s),type:"number",step:"0.01",class:"input w-32 text-left py-1"},null,512),[[f,g.value,void 0,{number:!0}]])]),e("div",Ye,[t[19]||(t[19]=e("span",null,"الإجمالي:",-1)),e("span",Ze,i(o(P)(M.value)),1)]),e("div",et,[t[20]||(t[20]=e("span",null,"المبلغ المدفوع:",-1)),v(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>C.value=s),type:"number",step:"0.01",placeholder:M.value.toString(),class:"input w-32 text-left py-1"},null,8,tt),[[f,C.value,void 0,{number:!0}]])]),E.value>0?(d(),c("div",st,[t[21]||(t[21]=e("span",null,"المتبقي:",-1)),e("span",null,i(o(P)(E.value)),1)])):S("",!0)]),e("div",at,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium mb-2"},"طريقة الدفع",-1)),e("div",ot,[(d(),c(U,null,$(J,s=>e("button",{key:s.value,onClick:p=>F.value=s.value,class:R([F.value===s.value?"bg-primary-600 text-white":"bg-gray-100","py-2 rounded-lg font-medium transition-all"])},i(s.label),11,lt)),64))])]),e("div",nt,[e("button",{onClick:oe,disabled:u.value.length===0,class:"btn btn-success w-full py-3 text-lg"}," إتمام البيع ",8,rt),e("button",{onClick:se,class:"btn btn-secondary w-full"}," مسح السلة ")])])]),V.value?(d(),c("div",ut,[e("div",it,[t[23]||(t[23]=e("h3",{class:"text-2xl font-bold mb-4"},"مسح الباركود",-1)),v(e("input",{ref_key:"barcodeInput",ref:A,"onUpdate:modelValue":t[6]||(t[6]=s=>h.value=s),onKeyup:ce(Q,["enter"]),type:"text",placeholder:"امسح أو اكتب الباركود...",class:"input mb-4",autofocus:""},null,544),[[f,h.value]]),e("div",ct,[e("button",{onClick:t[7]||(t[7]=s=>V.value=!1),class:"btn btn-secondary flex-1"},"إلغاء"),e("button",{onClick:Q,class:"btn btn-primary flex-1"},"بحث")])])])):S("",!0),q.value?(d(),c("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t[11]||(t[11]=G(s=>q.value=!1,["self"]))},[e("div",dt,[t[27]||(t[27]=e("h3",{class:"text-2xl font-bold mb-4"},"إضافة عميل",-1)),e("form",{onSubmit:G(ae,["prevent"]),class:"space-y-4"},[e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium mb-2"},"الاسم *",-1)),v(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>_.value.name=s),type:"text",required:"",class:"input"},null,512),[[f,_.value.name]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium mb-2"},"رقم الهاتف *",-1)),v(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>_.value.phone=s),type:"tel",required:"",class:"input"},null,512),[[f,_.value.phone]])]),e("div",pt,[e("button",{type:"button",onClick:t[10]||(t[10]=s=>q.value=!1),class:"btn btn-secondary flex-1"},"إلغاء"),t[26]||(t[26]=e("button",{type:"submit",class:"btn btn-primary flex-1"},"حفظ",-1))])],32)])])):S("",!0)]))}};export{_t as default};
