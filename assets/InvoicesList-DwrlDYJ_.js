import{_ as T,u as B,b as G,r as p,C as U,h as M,c as r,o as u,d as t,j as g,F as I,m as x,s as V,x as X,t as n,e as m,v as y,k as h,l as f,y as k}from"./index-BATAqFG0.js";import{E as j}from"./eye-B92gCjLv.js";import{D as R,X as q}from"./x-circle-haEEpH-D.js";import"./createLucideIcon-BF6gkLvI.js";const A={class:"invoices-container"},H={class:"tabs"},J=["onClick"],K={key:0,class:"badge"},O={class:"filters"},Q={class:"table-container"},W={class:"actions"},Y=["onClick"],Z=["onClick"],tt=["onClick"],et={key:0,class:"pagination"},at=["disabled"],st=["disabled"],lt={__name:"InvoicesList",setup(nt){const $=B(),c=G(),i=p("all"),D=p([]),v=p({}),o=p({search:"",startDate:"",endDate:""}),l=p({current_page:1,last_page:1,per_page:20,total:0}),E=[{label:"الكل",value:"all"},{label:"غير مدفوع",value:"unpaid"},{label:"مدفوع جزئياً",value:"partially_paid"},{label:"مدفوع",value:"paid"},{label:"ملغي",value:"void"}],d=async(s=1)=>{try{const a={page:s,status:i.value!=="all"?i.value:void 0,start_date:o.value.startDate||void 0,end_date:o.value.endDate||void 0},e=await k.getSales(a);D.value=e.data.sales.data,v.value=e.data.counts,l.value={current_page:e.data.sales.current_page,last_page:e.data.sales.last_page,per_page:e.data.sales.per_page,total:e.data.sales.total}}catch(a){c.error("فشل تحميل الفواتير"),console.error(a)}},F=s=>{$.push(`/invoices/${s}`)},L=async s=>{try{await k.downloadInvoicePdf(s),c.success("تم تحميل الفاتورة")}catch{c.error("فشل تحميل الفاتورة")}},N=async s=>{if(confirm("هل أنت متأكد من إلغاء هذه الفاتورة؟"))try{await k.voidSale(s),c.success("تم إلغاء الفاتورة"),d(l.value.current_page)}catch{c.error("فشل إلغاء الفاتورة")}},C=s=>{d(s)},P=()=>{o.value={search:"",startDate:"",endDate:""},d()},S=s=>new Date(s).toLocaleDateString("ar-EG"),_=s=>new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(s),z=s=>({draft:"مسودة",issued:"صادر",partially_paid:"مدفوع جزئياً",paid:"مدفوع",void:"ملغي"})[s]||s;return U(i,()=>{d()}),M(()=>{d()}),(s,a)=>(u(),r("div",A,[a[6]||(a[6]=t("div",{class:"header"},[t("h1",null,"الفواتير")],-1)),t("div",H,[(u(),r(I,null,x(E,e=>t("button",{key:e.value,class:V(["tab",{active:i.value===e.value}]),onClick:b=>i.value=e.value},[X(n(e.label)+" ",1),v.value[e.value]?(u(),r("span",K,n(v.value[e.value]),1)):g("",!0)],10,J)),64))]),t("div",O,[m(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>o.value.search=e),type:"text",placeholder:"بحث برقم الفاتورة أو العميل...",class:"search-input"},null,512),[[y,o.value.search]]),m(t("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>o.value.startDate=e),type:"date",class:"date-input"},null,512),[[y,o.value.startDate]]),m(t("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>o.value.endDate=e),type:"date",class:"date-input"},null,512),[[y,o.value.endDate]]),t("button",{onClick:d,class:"btn-primary"},"بحث"),t("button",{onClick:P,class:"btn-secondary"},"إعادة تعيين")]),t("div",Q,[t("table",null,[a[5]||(a[5]=t("thead",null,[t("tr",null,[t("th",null,"رقم الفاتورة"),t("th",null,"العميل"),t("th",null,"التاريخ"),t("th",null,"الإجمالي"),t("th",null,"المدفوع"),t("th",null,"المتبقي"),t("th",null,"الحالة"),t("th",null,"الإجراءات")])],-1)),t("tbody",null,[(u(!0),r(I,null,x(D.value,e=>{var b;return u(),r("tr",{key:e.id},[t("td",null,n(e.invoice_number),1),t("td",null,n(((b=e.customer)==null?void 0:b.name)||"عميل عادي"),1),t("td",null,n(S(e.issue_date||e.created_at)),1),t("td",null,n(_(e.total)),1),t("td",null,n(_(e.paid_sum)),1),t("td",null,n(_(e.balance_due)),1),t("td",null,[t("span",{class:V(["status-badge",e.status])},n(z(e.status)),3)]),t("td",W,[t("button",{onClick:w=>F(e.id),class:"btn-icon",title:"عرض"},[h(f(j),{size:18})],8,Y),t("button",{onClick:w=>L(e.id),class:"btn-icon",title:"تحميل PDF"},[h(f(R),{size:18})],8,Z),e.status!=="void"?(u(),r("button",{key:0,onClick:w=>N(e.id),class:"btn-icon btn-danger",title:"إلغاء"},[h(f(q),{size:18})],8,tt)):g("",!0)])])}),128))])])]),l.value.total>l.value.per_page?(u(),r("div",et,[t("button",{onClick:a[3]||(a[3]=e=>C(l.value.current_page-1)),disabled:l.value.current_page===1,class:"btn-secondary"}," السابق ",8,at),t("span",null,"صفحة "+n(l.value.current_page)+" من "+n(l.value.last_page),1),t("button",{onClick:a[4]||(a[4]=e=>C(l.value.current_page+1)),disabled:l.value.current_page===l.value.last_page,class:"btn-secondary"}," التالي ",8,st)])):g("",!0)]))}},ct=T(lt,[["__scopeId","data-v-cde80c2d"]]);export{ct as default};
