import{_ as q,f as A,u as G,b as T,r as w,h as E,c as o,j as v,o as r,d as t,k as b,x as f,l as k,t as n,s as W,F as I,m as S,e as g,v as C,z as X,D as j,w as O,y as m}from"./index-DyWVem4z.js";import{c as V}from"./createLucideIcon--34oW_Gd.js";import{P as H}from"./plus-Y9XiTSYj.js";import{D as J,X as K}from"./x-circle-B-L7FvF2.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=V("ArrowRightIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=V("Share2Icon",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),Z={key:0,class:"invoice-detail"},tt={class:"header"},et={class:"content"},lt={class:"card"},st={class:"info-grid"},at={class:"info-item"},nt={class:"info-item"},ot={class:"info-item"},rt={class:"info-item"},ut={class:"card"},it={class:"totals"},dt={class:"total-row"},vt={key:0,class:"total-row"},ct={key:1,class:"total-row"},pt={key:2,class:"total-row"},mt={class:"total-row total"},yt={class:"total-row paid"},bt={key:3,class:"total-row balance"},ft={class:"card"},kt={class:"card-header"},wt={key:0,class:"empty-state"},gt={key:1},ht={class:"actions-bar"},xt={class:"modal-header"},_t={class:"modal-body"},Ct={class:"form-group"},Dt=["max"],Pt={class:"form-group"},It={class:"form-group"},St={class:"form-group"},Vt={class:"modal-footer"},zt={__name:"InvoiceDetail",setup(Ft){const c=A();G();const i=T(),l=w(null),h=w([]),p=w(!1),u=w({amount:0,method:"cash",reference:"",notes:""}),x=async()=>{try{const s=await m.getSale(c.params.id);l.value=s.data}catch(s){i.error("فشل تحميل الفاتورة"),console.error(s)}},D=async()=>{try{const s=await m.getPayments(c.params.id);h.value=s.data}catch(s){console.error("Failed to load payments:",s)}},z=async()=>{if(!u.value.amount||u.value.amount<=0){i.error("الرجاء إدخال مبلغ صحيح");return}if(u.value.amount>l.value.balance_due){i.error("المبلغ أكبر من المتبقي");return}try{await m.recordPayment(c.params.id,u.value),i.success("تم تسجيل الدفعة بنجاح"),p.value=!1,u.value={amount:0,method:"cash",reference:"",notes:""},x(),D()}catch(s){i.error("فشل تسجيل الدفعة"),console.error(s)}},F=async()=>{try{await m.downloadInvoicePdf(c.params.id),i.success("تم تحميل الفاتورة")}catch{i.error("فشل تحميل الفاتورة")}},M=async()=>{try{const s=await m.getWhatsAppMessage(c.params.id),{message:e,phone:y}=s.data;if(!y){i.error("لا يوجد رقم هاتف للعميل");return}const a=`https://wa.me/${y.replace(/[^0-9]/g,"")}?text=${encodeURIComponent(e)}`;window.open(a,"_blank"),i.success("تم فتح واتساب")}catch{i.error("فشل مشاركة الفاتورة")}},$=async()=>{if(confirm("هل أنت متأكد من إلغاء هذه الفاتورة؟ لا يمكن التراجع عن هذا الإجراء."))try{await m.voidSale(c.params.id),i.success("تم إلغاء الفاتورة"),x()}catch{i.error("فشل إلغاء الفاتورة")}},L=s=>new Date(s).toLocaleDateString("en-GB"),N=s=>new Date(s).toLocaleString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),d=s=>new Intl.NumberFormat("en-EG",{style:"currency",currency:"EGP",minimumFractionDigits:2}).format(s).replace(/[٠-٩]/g,e=>"٠١٢٣٤٥٦٧٨٩".indexOf(e)),U=s=>({draft:"مسودة",issued:"صادر",partially_paid:"مدفوع جزئياً",paid:"مدفوع",void:"ملغي"})[s]||s,B=s=>({cash:"نقدي",card:"بطاقة",bank:"تحويل بنكي",wallet:"محفظة إلكترونية",cod:"الدفع عند الاستلام"})[s]||s;return E(()=>{x(),D()}),(s,e)=>{var y,_;return l.value?(r(),o("div",Z,[t("div",tt,[t("button",{onClick:e[0]||(e[0]=a=>s.$router.back()),class:"btn-back"},[b(k(Q),{size:20}),e[10]||(e[10]=f(" رجوع ",-1))]),t("h1",null,"فاتورة "+n(l.value.invoice_number),1),t("span",{class:W(["status-badge",l.value.status])},n(U(l.value.status)),3)]),t("div",et,[t("div",lt,[e[15]||(e[15]=t("h2",null,"معلومات الفاتورة",-1)),t("div",st,[t("div",at,[e[11]||(e[11]=t("label",null,"رقم الفاتورة:",-1)),t("span",null,n(l.value.invoice_number),1)]),t("div",nt,[e[12]||(e[12]=t("label",null,"التاريخ:",-1)),t("span",null,n(L(l.value.issue_date||l.value.created_at)),1)]),t("div",ot,[e[13]||(e[13]=t("label",null,"العميل:",-1)),t("span",null,n(((y=l.value.customer)==null?void 0:y.name)||"عميل عادي"),1)]),t("div",rt,[e[14]||(e[14]=t("label",null,"الهاتف:",-1)),t("span",null,n(((_=l.value.customer)==null?void 0:_.phone)||"-"),1)])])]),t("div",ut,[e[24]||(e[24]=t("h2",null,"المنتجات",-1)),t("table",null,[e[16]||(e[16]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"المنتج"),t("th",null,"الكمية"),t("th",null,"السعر"),t("th",null,"الإجمالي")])],-1)),t("tbody",null,[(r(!0),o(I,null,S(l.value.items,(a,R)=>{var P;return r(),o("tr",{key:a.id},[t("td",null,n(R+1),1),t("td",null,n((P=a.product)==null?void 0:P.name_ar),1),t("td",null,n(a.quantity),1),t("td",null,n(d(a.unit_price)),1),t("td",null,n(d(a.total_price)),1)])}),128))])]),t("div",it,[t("div",dt,[e[17]||(e[17]=t("span",null,"المجموع الفرعي:",-1)),t("span",null,n(d(l.value.subtotal)),1)]),l.value.discount>0?(r(),o("div",vt,[e[18]||(e[18]=t("span",null,"الخصم:",-1)),t("span",null,"-"+n(d(l.value.discount)),1)])):v("",!0),l.value.tax>0?(r(),o("div",ct,[e[19]||(e[19]=t("span",null,"الضريبة:",-1)),t("span",null,n(d(l.value.tax)),1)])):v("",!0),l.value.shipping>0?(r(),o("div",pt,[e[20]||(e[20]=t("span",null,"الشحن:",-1)),t("span",null,n(d(l.value.shipping)),1)])):v("",!0),t("div",mt,[e[21]||(e[21]=t("span",null,"الإجمالي:",-1)),t("span",null,n(d(l.value.total)),1)]),t("div",yt,[e[22]||(e[22]=t("span",null,"المدفوع:",-1)),t("span",null,n(d(l.value.paid_sum)),1)]),l.value.balance_due>0?(r(),o("div",bt,[e[23]||(e[23]=t("span",null,"المتبقي:",-1)),t("span",null,n(d(l.value.balance_due)),1)])):v("",!0)])]),t("div",ft,[t("div",kt,[e[26]||(e[26]=t("h2",null,"المدفوعات",-1)),l.value.balance_due>0&&l.value.status!=="void"?(r(),o("button",{key:0,onClick:e[1]||(e[1]=a=>p.value=!0),class:"btn-primary"},[b(k(H),{size:18}),e[25]||(e[25]=f(" تسجيل دفعة ",-1))])):v("",!0)]),h.value.length===0?(r(),o("div",wt," لا توجد مدفوعات مسجلة ")):(r(),o("table",gt,[e[27]||(e[27]=t("thead",null,[t("tr",null,[t("th",null,"التاريخ"),t("th",null,"المبلغ"),t("th",null,"الطريقة"),t("th",null,"المرجع"),t("th",null,"الملاحظات")])],-1)),t("tbody",null,[(r(!0),o(I,null,S(h.value,a=>(r(),o("tr",{key:a.id},[t("td",null,n(N(a.paid_at)),1),t("td",null,n(d(a.amount)),1),t("td",null,n(B(a.method)),1),t("td",null,n(a.reference||"-"),1),t("td",null,n(a.notes||"-"),1)]))),128))])]))]),t("div",ht,[t("button",{onClick:F,class:"btn-primary"},[b(k(J),{size:18}),e[28]||(e[28]=f(" تحميل PDF ",-1))]),t("button",{onClick:M,class:"btn-success"},[b(k(Y),{size:18}),e[29]||(e[29]=f(" مشاركة واتساب ",-1))]),l.value.status!=="void"?(r(),o("button",{key:0,onClick:$,class:"btn-danger"},[b(k(K),{size:18}),e[30]||(e[30]=f(" إلغاء الفاتورة ",-1))])):v("",!0)])]),p.value?(r(),o("div",{key:0,class:"modal-overlay",onClick:e[9]||(e[9]=a=>p.value=!1)},[t("div",{class:"modal",onClick:e[8]||(e[8]=O(()=>{},["stop"]))},[t("div",xt,[e[31]||(e[31]=t("h3",null,"تسجيل دفعة جديدة",-1)),t("button",{onClick:e[2]||(e[2]=a=>p.value=!1),class:"btn-close"},"×")]),t("div",_t,[t("div",Ct,[e[32]||(e[32]=t("label",null,"المبلغ *",-1)),g(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.amount=a),type:"number",step:"0.01",max:l.value.balance_due,placeholder:"0.00"},null,8,Dt),[[C,u.value.amount,void 0,{number:!0}]]),t("small",null,"المتبقي: "+n(d(l.value.balance_due)),1)]),t("div",Pt,[e[34]||(e[34]=t("label",null,"طريقة الدفع *",-1)),g(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>u.value.method=a)},[...e[33]||(e[33]=[j('<option value="cash" data-v-a0afed26>نقدي</option><option value="card" data-v-a0afed26>بطاقة</option><option value="bank" data-v-a0afed26>تحويل بنكي</option><option value="wallet" data-v-a0afed26>محفظة إلكترونية</option><option value="cod" data-v-a0afed26>الدفع عند الاستلام</option>',5)])],512),[[X,u.value.method]])]),t("div",It,[e[35]||(e[35]=t("label",null,"المرجع",-1)),g(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>u.value.reference=a),type:"text",placeholder:"رقم المعاملة أو المرجع"},null,512),[[C,u.value.reference]])]),t("div",St,[e[36]||(e[36]=t("label",null,"ملاحظات",-1)),g(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=a=>u.value.notes=a),rows:"3",placeholder:"ملاحظات إضافية"},null,512),[[C,u.value.notes]])])]),t("div",Vt,[t("button",{onClick:e[7]||(e[7]=a=>p.value=!1),class:"btn-secondary"},"إلغاء"),t("button",{onClick:z,class:"btn-primary"},"حفظ")])])])):v("",!0)])):v("",!0)}}},Ut=q(zt,[["__scopeId","data-v-a0afed26"]]);export{Ut as default};
