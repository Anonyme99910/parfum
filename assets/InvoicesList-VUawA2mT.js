import{_ as z,u as T,b as G,r as p,C as U,h as K,c as u,o as d,d as t,j as m,F as x,m as I,s as F,x as M,t as n,e as g,v as y,B as X,k as h,l as f,y as k}from"./index-zI5gLbG8.js";import{E as j}from"./eye-ElarNvrf.js";import{D as O,X as R}from"./x-circle-DhN9GtyV.js";import"./createLucideIcon-kWj9vmF7.js";const q={class:"invoices-container"},A={class:"tabs"},H=["onClick"],J={key:0,class:"badge"},Q={class:"filters"},W={class:"date-filter"},Y={class:"date-filter"},Z={class:"table-container"},tt={class:"actions"},et=["onClick"],at=["onClick"],st=["onClick"],lt={key:0,class:"pagination"},nt=["disabled"],ot=["disabled"],rt={__name:"InvoicesList",setup(ut){const V=T(),i=G(),c=p("all"),D=p([]),v=p({}),o=p({search:"",startDate:"",endDate:""}),l=p({current_page:1,last_page:1,per_page:20,total:0}),$=[{label:"الكل",value:"all"},{label:"غير مدفوع",value:"unpaid"},{label:"مدفوع جزئياً",value:"partially_paid"},{label:"مدفوع",value:"paid"},{label:"ملغي",value:"void"}],r=async(s=1)=>{try{const a={page:s,status:c.value!=="all"?c.value:void 0,start_date:o.value.startDate||void 0,end_date:o.value.endDate||void 0},e=await k.getSales(a);D.value=e.data.sales.data,v.value=e.data.counts,l.value={current_page:e.data.sales.current_page,last_page:e.data.sales.last_page,per_page:e.data.sales.per_page,total:e.data.sales.total}}catch(a){i.error("فشل تحميل الفواتير"),console.error(a)}},B=s=>{V.push(`/invoices/${s}`)},E=async s=>{try{await k.downloadInvoicePdf(s),i.success("تم تحميل الفاتورة")}catch{i.error("فشل تحميل الفاتورة")}},L=async s=>{if(confirm("هل أنت متأكد من إلغاء هذه الفاتورة؟"))try{await k.voidSale(s),i.success("تم إلغاء الفاتورة"),r(l.value.current_page)}catch{i.error("فشل إلغاء الفاتورة")}},C=s=>{r(s)},N=()=>{o.value={search:"",startDate:"",endDate:""},r()},P=s=>new Date(s).toLocaleDateString("en-GB"),_=s=>new Intl.NumberFormat("en-EG",{style:"currency",currency:"EGP",minimumFractionDigits:2}).format(s).replace(/[٠-٩]/g,a=>"٠١٢٣٤٥٦٧٨٩".indexOf(a)),S=s=>({draft:"مسودة",issued:"صادر",partially_paid:"مدفوع جزئياً",paid:"مدفوع",void:"ملغي"})[s]||s;return U(c,()=>{r()}),K(()=>{r()}),(s,a)=>(d(),u("div",q,[a[8]||(a[8]=t("div",{class:"header"},[t("h1",null,"الفواتير")],-1)),t("div",A,[(d(),u(x,null,I($,e=>t("button",{key:e.value,class:F(["tab",{active:c.value===e.value}]),onClick:b=>c.value=e.value},[M(n(e.label)+" ",1),v.value[e.value]?(d(),u("span",J,n(v.value[e.value]),1)):m("",!0)],10,H)),64))]),t("div",Q,[g(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>o.value.search=e),type:"text",placeholder:"بحث برقم الفاتورة أو العميل...",class:"search-input",onKeyup:X(r,["enter"])},null,544),[[y,o.value.search]]),t("div",W,[a[5]||(a[5]=t("label",null,"من تاريخ:",-1)),g(t("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>o.value.startDate=e),type:"date",class:"date-input"},null,512),[[y,o.value.startDate]])]),t("div",Y,[a[6]||(a[6]=t("label",null,"إلى تاريخ:",-1)),g(t("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>o.value.endDate=e),type:"date",class:"date-input"},null,512),[[y,o.value.endDate]])]),t("button",{onClick:r,class:"btn-primary"},"بحث"),t("button",{onClick:N,class:"btn-secondary"},"مسح الفلاتر")]),t("div",Z,[t("table",null,[a[7]||(a[7]=t("thead",null,[t("tr",null,[t("th",null,"رقم الفاتورة"),t("th",null,"العميل"),t("th",null,"التاريخ"),t("th",null,"الإجمالي"),t("th",null,"المدفوع"),t("th",null,"المتبقي"),t("th",null,"الحالة"),t("th",null,"الإجراءات")])],-1)),t("tbody",null,[(d(!0),u(x,null,I(D.value,e=>{var b;return d(),u("tr",{key:e.id},[t("td",null,n(e.invoice_number),1),t("td",null,n(((b=e.customer)==null?void 0:b.name)||"عميل عادي"),1),t("td",null,n(P(e.issue_date||e.created_at)),1),t("td",null,n(_(e.total)),1),t("td",null,n(_(e.paid_sum)),1),t("td",null,n(_(e.balance_due)),1),t("td",null,[t("span",{class:F(["status-badge",e.status])},n(S(e.status)),3)]),t("td",tt,[t("button",{onClick:w=>B(e.id),class:"btn-icon",title:"عرض"},[h(f(j),{size:18})],8,et),t("button",{onClick:w=>E(e.id),class:"btn-icon",title:"تحميل PDF"},[h(f(O),{size:18})],8,at),e.status!=="void"?(d(),u("button",{key:0,onClick:w=>L(e.id),class:"btn-icon btn-danger",title:"إلغاء"},[h(f(R),{size:18})],8,st)):m("",!0)])])}),128))])])]),l.value.total>l.value.per_page?(d(),u("div",lt,[t("button",{onClick:a[3]||(a[3]=e=>C(l.value.current_page-1)),disabled:l.value.current_page===1,class:"btn-secondary"}," السابق ",8,nt),t("span",null,"صفحة "+n(l.value.current_page)+" من "+n(l.value.last_page),1),t("button",{onClick:a[4]||(a[4]=e=>C(l.value.current_page+1)),disabled:l.value.current_page===l.value.last_page,class:"btn-secondary"}," التالي ",8,ot)])):m("",!0)]))}},vt=z(rt,[["__scopeId","data-v-b77c3005"]]);export{vt as default};
