import{_ as q,f as A,u as G,b as T,r as w,h as B,c as n,j as v,o as r,d as t,k as b,x as f,l as k,t as a,s as W,F as I,m as S,e as g,v as C,z as X,D as j,w as H,y as m}from"./index-BATAqFG0.js";import{c as V}from"./createLucideIcon-BF6gkLvI.js";import{P as J}from"./plus-L0XNAunK.js";import{D as K,X as O}from"./x-circle-haEEpH-D.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=V("ArrowRightIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=V("Share2Icon",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),Z={key:0,class:"invoice-detail"},tt={class:"header"},lt={class:"content"},et={class:"card"},st={class:"info-grid"},ot={class:"info-item"},at={class:"info-item"},nt={class:"info-item"},rt={class:"info-item"},ut={class:"card"},dt={class:"totals"},it={class:"total-row"},vt={key:0,class:"total-row"},ct={key:1,class:"total-row"},pt={key:2,class:"total-row"},mt={class:"total-row total"},yt={class:"total-row paid"},bt={key:3,class:"total-row balance"},ft={class:"card"},kt={class:"card-header"},wt={key:0,class:"empty-state"},gt={key:1},xt={class:"actions-bar"},ht={class:"modal-header"},_t={class:"modal-body"},Ct={class:"form-group"},Dt=["max"],Pt={class:"form-group"},It={class:"form-group"},St={class:"form-group"},Vt={class:"modal-footer"},zt={__name:"InvoiceDetail",setup(Mt){const c=A();G();const d=T(),e=w(null),x=w([]),p=w(!1),u=w({amount:0,method:"cash",reference:"",notes:""}),h=async()=>{try{const s=await m.getSale(c.params.id);e.value=s.data}catch(s){d.error("فشل تحميل الفاتورة"),console.error(s)}},D=async()=>{try{const s=await m.getPayments(c.params.id);x.value=s.data}catch(s){console.error("Failed to load payments:",s)}},z=async()=>{if(!u.value.amount||u.value.amount<=0){d.error("الرجاء إدخال مبلغ صحيح");return}if(u.value.amount>e.value.balance_due){d.error("المبلغ أكبر من المتبقي");return}try{await m.recordPayment(c.params.id,u.value),d.success("تم تسجيل الدفعة بنجاح"),p.value=!1,u.value={amount:0,method:"cash",reference:"",notes:""},h(),D()}catch(s){d.error("فشل تسجيل الدفعة"),console.error(s)}},M=async()=>{try{await m.downloadInvoicePdf(c.params.id),d.success("تم تحميل الفاتورة")}catch{d.error("فشل تحميل الفاتورة")}},$=async()=>{try{const s=await m.getWhatsAppMessage(c.params.id),{message:l,phone:y}=s.data;if(!y){d.error("لا يوجد رقم هاتف للعميل");return}const o=`https://wa.me/${y.replace(/[^0-9]/g,"")}?text=${encodeURIComponent(l)}`;window.open(o,"_blank"),d.success("تم فتح واتساب")}catch{d.error("فشل مشاركة الفاتورة")}},F=async()=>{if(confirm("هل أنت متأكد من إلغاء هذه الفاتورة؟ لا يمكن التراجع عن هذا الإجراء."))try{await m.voidSale(c.params.id),d.success("تم إلغاء الفاتورة"),h()}catch{d.error("فشل إلغاء الفاتورة")}},L=s=>new Date(s).toLocaleDateString("ar-EG"),N=s=>new Date(s).toLocaleString("ar-EG"),i=s=>new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(s),U=s=>({draft:"مسودة",issued:"صادر",partially_paid:"مدفوع جزئياً",paid:"مدفوع",void:"ملغي"})[s]||s,E=s=>({cash:"نقدي",card:"بطاقة",bank:"تحويل بنكي",wallet:"محفظة إلكترونية",cod:"الدفع عند الاستلام"})[s]||s;return B(()=>{h(),D()}),(s,l)=>{var y,_;return e.value?(r(),n("div",Z,[t("div",tt,[t("button",{onClick:l[0]||(l[0]=o=>s.$router.back()),class:"btn-back"},[b(k(Q),{size:20}),l[10]||(l[10]=f(" رجوع ",-1))]),t("h1",null,"فاتورة "+a(e.value.invoice_number),1),t("span",{class:W(["status-badge",e.value.status])},a(U(e.value.status)),3)]),t("div",lt,[t("div",et,[l[15]||(l[15]=t("h2",null,"معلومات الفاتورة",-1)),t("div",st,[t("div",ot,[l[11]||(l[11]=t("label",null,"رقم الفاتورة:",-1)),t("span",null,a(e.value.invoice_number),1)]),t("div",at,[l[12]||(l[12]=t("label",null,"التاريخ:",-1)),t("span",null,a(L(e.value.issue_date||e.value.created_at)),1)]),t("div",nt,[l[13]||(l[13]=t("label",null,"العميل:",-1)),t("span",null,a(((y=e.value.customer)==null?void 0:y.name)||"عميل عادي"),1)]),t("div",rt,[l[14]||(l[14]=t("label",null,"الهاتف:",-1)),t("span",null,a(((_=e.value.customer)==null?void 0:_.phone)||"-"),1)])])]),t("div",ut,[l[24]||(l[24]=t("h2",null,"المنتجات",-1)),t("table",null,[l[16]||(l[16]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"المنتج"),t("th",null,"الكمية"),t("th",null,"السعر"),t("th",null,"الإجمالي")])],-1)),t("tbody",null,[(r(!0),n(I,null,S(e.value.items,(o,R)=>{var P;return r(),n("tr",{key:o.id},[t("td",null,a(R+1),1),t("td",null,a((P=o.product)==null?void 0:P.name_ar),1),t("td",null,a(o.quantity),1),t("td",null,a(i(o.unit_price)),1),t("td",null,a(i(o.total_price)),1)])}),128))])]),t("div",dt,[t("div",it,[l[17]||(l[17]=t("span",null,"المجموع الفرعي:",-1)),t("span",null,a(i(e.value.subtotal)),1)]),e.value.discount>0?(r(),n("div",vt,[l[18]||(l[18]=t("span",null,"الخصم:",-1)),t("span",null,"-"+a(i(e.value.discount)),1)])):v("",!0),e.value.tax>0?(r(),n("div",ct,[l[19]||(l[19]=t("span",null,"الضريبة:",-1)),t("span",null,a(i(e.value.tax)),1)])):v("",!0),e.value.shipping>0?(r(),n("div",pt,[l[20]||(l[20]=t("span",null,"الشحن:",-1)),t("span",null,a(i(e.value.shipping)),1)])):v("",!0),t("div",mt,[l[21]||(l[21]=t("span",null,"الإجمالي:",-1)),t("span",null,a(i(e.value.total)),1)]),t("div",yt,[l[22]||(l[22]=t("span",null,"المدفوع:",-1)),t("span",null,a(i(e.value.paid_sum)),1)]),e.value.balance_due>0?(r(),n("div",bt,[l[23]||(l[23]=t("span",null,"المتبقي:",-1)),t("span",null,a(i(e.value.balance_due)),1)])):v("",!0)])]),t("div",ft,[t("div",kt,[l[26]||(l[26]=t("h2",null,"المدفوعات",-1)),e.value.balance_due>0&&e.value.status!=="void"?(r(),n("button",{key:0,onClick:l[1]||(l[1]=o=>p.value=!0),class:"btn-primary"},[b(k(J),{size:18}),l[25]||(l[25]=f(" تسجيل دفعة ",-1))])):v("",!0)]),x.value.length===0?(r(),n("div",wt," لا توجد مدفوعات مسجلة ")):(r(),n("table",gt,[l[27]||(l[27]=t("thead",null,[t("tr",null,[t("th",null,"التاريخ"),t("th",null,"المبلغ"),t("th",null,"الطريقة"),t("th",null,"المرجع"),t("th",null,"الملاحظات")])],-1)),t("tbody",null,[(r(!0),n(I,null,S(x.value,o=>(r(),n("tr",{key:o.id},[t("td",null,a(N(o.paid_at)),1),t("td",null,a(i(o.amount)),1),t("td",null,a(E(o.method)),1),t("td",null,a(o.reference||"-"),1),t("td",null,a(o.notes||"-"),1)]))),128))])]))]),t("div",xt,[t("button",{onClick:M,class:"btn-primary"},[b(k(K),{size:18}),l[28]||(l[28]=f(" تحميل PDF ",-1))]),t("button",{onClick:$,class:"btn-success"},[b(k(Y),{size:18}),l[29]||(l[29]=f(" مشاركة واتساب ",-1))]),e.value.status!=="void"?(r(),n("button",{key:0,onClick:F,class:"btn-danger"},[b(k(O),{size:18}),l[30]||(l[30]=f(" إلغاء الفاتورة ",-1))])):v("",!0)])]),p.value?(r(),n("div",{key:0,class:"modal-overlay",onClick:l[9]||(l[9]=o=>p.value=!1)},[t("div",{class:"modal",onClick:l[8]||(l[8]=H(()=>{},["stop"]))},[t("div",ht,[l[31]||(l[31]=t("h3",null,"تسجيل دفعة جديدة",-1)),t("button",{onClick:l[2]||(l[2]=o=>p.value=!1),class:"btn-close"},"×")]),t("div",_t,[t("div",Ct,[l[32]||(l[32]=t("label",null,"المبلغ *",-1)),g(t("input",{"onUpdate:modelValue":l[3]||(l[3]=o=>u.value.amount=o),type:"number",step:"0.01",max:e.value.balance_due,placeholder:"0.00"},null,8,Dt),[[C,u.value.amount,void 0,{number:!0}]]),t("small",null,"المتبقي: "+a(i(e.value.balance_due)),1)]),t("div",Pt,[l[34]||(l[34]=t("label",null,"طريقة الدفع *",-1)),g(t("select",{"onUpdate:modelValue":l[4]||(l[4]=o=>u.value.method=o)},[...l[33]||(l[33]=[j('<option value="cash" data-v-cdf0a874>نقدي</option><option value="card" data-v-cdf0a874>بطاقة</option><option value="bank" data-v-cdf0a874>تحويل بنكي</option><option value="wallet" data-v-cdf0a874>محفظة إلكترونية</option><option value="cod" data-v-cdf0a874>الدفع عند الاستلام</option>',5)])],512),[[X,u.value.method]])]),t("div",It,[l[35]||(l[35]=t("label",null,"المرجع",-1)),g(t("input",{"onUpdate:modelValue":l[5]||(l[5]=o=>u.value.reference=o),type:"text",placeholder:"رقم المعاملة أو المرجع"},null,512),[[C,u.value.reference]])]),t("div",St,[l[36]||(l[36]=t("label",null,"ملاحظات",-1)),g(t("textarea",{"onUpdate:modelValue":l[6]||(l[6]=o=>u.value.notes=o),rows:"3",placeholder:"ملاحظات إضافية"},null,512),[[C,u.value.notes]])])]),t("div",Vt,[t("button",{onClick:l[7]||(l[7]=o=>p.value=!1),class:"btn-secondary"},"إلغاء"),t("button",{onClick:z,class:"btn-primary"},"حفظ")])])])):v("",!0)])):v("",!0)}}},Ut=q(zt,[["__scopeId","data-v-cdf0a874"]]);export{Ut as default};
