import{_ as G,u as U,b as K,r as p,C as M,h as X,c as r,o as d,d as e,j as v,F,m as V,s as $,x as B,t as l,e as h,v as g,B as j,k as y,l as f,y as k}from"./index-Cni0faZZ.js";import{E as O}from"./eye-BzkxHPIA.js";import{D as R,X as q}from"./x-circle-DLlZxDKf.js";import"./createLucideIcon-B_ZycDWX.js";const A={class:"invoices-container"},H={class:"tabs"},J=["onClick"],Q={key:0,class:"badge"},W={class:"filters"},Y={class:"date-filter"},Z={class:"date-filter"},ee={class:"table-container"},te={class:"table-responsive"},ae={class:"invoice-number"},se={class:"mobile-info"},le={class:"hide-mobile"},ne={class:"hide-mobile"},oe={class:"amount-cell"},re={class:"mobile-amounts"},de={key:0},ue={class:"hide-tablet"},ie={class:"hide-tablet"},ce={class:"actions"},_e=["onClick"],pe=["onClick"],ve=["onClick"],be={key:0,class:"pagination"},me=["disabled"],he=["disabled"],ge={__name:"InvoicesList",setup(ye){const E=U(),i=K(),c=p("all"),D=p([]),b=p({}),o=p({search:"",startDate:"",endDate:""}),n=p({current_page:1,last_page:1,per_page:20,total:0}),L=[{label:"الكل",value:"all"},{label:"غير مدفوع",value:"unpaid"},{label:"مدفوع جزئياً",value:"partially_paid"},{label:"مدفوع",value:"paid"},{label:"ملغي",value:"void"}],u=async(s=1)=>{try{const a={page:s,status:c.value!=="all"?c.value:void 0,start_date:o.value.startDate||void 0,end_date:o.value.endDate||void 0},t=await k.getSales(a);D.value=t.data.sales.data,b.value=t.data.counts,n.value={current_page:t.data.sales.current_page,last_page:t.data.sales.last_page,per_page:t.data.sales.per_page,total:t.data.sales.total}}catch(a){i.error("فشل تحميل الفواتير"),console.error(a)}},N=s=>{E.push(`/invoices/${s}`)},P=async s=>{try{await k.downloadInvoicePdf(s),i.success("تم تحميل الفاتورة")}catch{i.error("فشل تحميل الفاتورة")}},S=async s=>{if(confirm("هل أنت متأكد من إلغاء هذه الفاتورة؟"))try{await k.voidSale(s),i.success("تم إلغاء الفاتورة"),u(n.value.current_page)}catch{i.error("فشل إلغاء الفاتورة")}},C=s=>{u(s)},z=()=>{o.value={search:"",startDate:"",endDate:""},u()},w=s=>new Date(s).toLocaleDateString("en-GB"),_=s=>new Intl.NumberFormat("en-EG",{style:"currency",currency:"EGP",minimumFractionDigits:2}).format(s).replace(/[٠-٩]/g,a=>"٠١٢٣٤٥٦٧٨٩".indexOf(a)),T=s=>({draft:"مسودة",issued:"صادر",partially_paid:"مدفوع جزئياً",paid:"مدفوع",void:"ملغي"})[s]||s;return M(c,()=>{u()}),X(()=>{u()}),(s,a)=>(d(),r("div",A,[a[8]||(a[8]=e("div",{class:"header"},[e("h1",null,"الفواتير")],-1)),e("div",H,[(d(),r(F,null,V(L,t=>e("button",{key:t.value,class:$(["tab",{active:c.value===t.value}]),onClick:m=>c.value=t.value},[B(l(t.label)+" ",1),b.value[t.value]?(d(),r("span",Q,l(b.value[t.value]),1)):v("",!0)],10,J)),64))]),e("div",W,[h(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>o.value.search=t),type:"text",placeholder:"بحث برقم الفاتورة أو العميل...",class:"search-input",onKeyup:j(u,["enter"])},null,544),[[g,o.value.search]]),e("div",Y,[a[5]||(a[5]=e("label",null,"من تاريخ:",-1)),h(e("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>o.value.startDate=t),type:"date",class:"date-input"},null,512),[[g,o.value.startDate]])]),e("div",Z,[a[6]||(a[6]=e("label",null,"إلى تاريخ:",-1)),h(e("input",{"onUpdate:modelValue":a[2]||(a[2]=t=>o.value.endDate=t),type:"date",class:"date-input"},null,512),[[g,o.value.endDate]])]),e("button",{onClick:u,class:"btn-primary"},"بحث"),e("button",{onClick:z,class:"btn-secondary"},"مسح الفلاتر")]),e("div",ee,[e("div",te,[e("table",null,[a[7]||(a[7]=e("thead",null,[e("tr",null,[e("th",null,"رقم الفاتورة"),e("th",{class:"hide-mobile"},"العميل"),e("th",{class:"hide-mobile"},"التاريخ"),e("th",null,"الإجمالي"),e("th",{class:"hide-tablet"},"المدفوع"),e("th",{class:"hide-tablet"},"المتبقي"),e("th",null,"الحالة"),e("th",null,"الإجراءات")])],-1)),e("tbody",null,[(d(!0),r(F,null,V(D.value,t=>{var m,x;return d(),r("tr",{key:t.id},[e("td",null,[e("div",ae,l(t.invoice_number),1),e("div",se,[e("small",null,l(((m=t.customer)==null?void 0:m.name)||"عميل عادي"),1),e("small",null,l(w(t.issue_date||t.created_at)),1)])]),e("td",le,l(((x=t.customer)==null?void 0:x.name)||"عميل عادي"),1),e("td",ne,l(w(t.issue_date||t.created_at)),1),e("td",null,[e("div",oe,[B(l(_(t.total))+" ",1),e("div",re,[e("small",null,"مدفوع: "+l(_(t.paid_sum)),1),t.balance_due>0?(d(),r("small",de,"متبقي: "+l(_(t.balance_due)),1)):v("",!0)])])]),e("td",ue,l(_(t.paid_sum)),1),e("td",ie,l(_(t.balance_due)),1),e("td",null,[e("span",{class:$(["status-badge",t.status])},l(T(t.status)),3)]),e("td",ce,[e("button",{onClick:I=>N(t.id),class:"btn-icon",title:"عرض"},[y(f(O),{size:18})],8,_e),e("button",{onClick:I=>P(t.id),class:"btn-icon hide-mobile",title:"تحميل PDF"},[y(f(R),{size:18})],8,pe),t.status!=="void"?(d(),r("button",{key:0,onClick:I=>S(t.id),class:"btn-icon btn-danger hide-mobile",title:"إلغاء"},[y(f(q),{size:18})],8,ve)):v("",!0)])])}),128))])])])]),n.value.total>n.value.per_page?(d(),r("div",be,[e("button",{onClick:a[3]||(a[3]=t=>C(n.value.current_page-1)),disabled:n.value.current_page===1,class:"btn-secondary"}," السابق ",8,me),e("span",null,"صفحة "+l(n.value.current_page)+" من "+l(n.value.last_page),1),e("button",{onClick:a[4]||(a[4]=t=>C(n.value.current_page+1)),disabled:n.value.current_page===n.value.last_page,class:"btn-secondary"}," التالي ",8,he)])):v("",!0)]))}},we=G(ge,[["__scopeId","data-v-9e6641f6"]]);export{we as default};
