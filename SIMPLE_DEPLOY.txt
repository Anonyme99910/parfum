#!/bin/bash
# Copy this ENTIRE file content
# Paste it in your SSH terminal
# Press Enter

set -e
PROJECT="/var/www/html/gt-academy.com/parfumes"
echo "Creating directory..."
mkdir -p $PROJECT
cd $PROJECT
echo "Directory created: $PROJECT"
echo ""
echo "Now upload files using FileZilla:"
echo "  To $PROJECT/: backend/, index.html, assets/"
echo "  To /root/: parfumes_db_backup.sql"
echo ""
read -p "Press Enter when files are uploaded..."
echo "Installing PHP..."
apt update -qq && apt install -y php php-fpm php-mysql php-mbstring php-xml php-curl php-zip php-gd -qq
echo "Installing Composer..."
curl -sS https://getcomposer.org/installer | php && mv composer.phar /usr/local/bin/composer && chmod +x /usr/local/bin/composer
echo "Installing dependencies..."
cd $PROJECT/backend && composer install --no-dev --optimize-autoloader --quiet
echo "Configuring Laravel..."
cat > $PROJECT/backend/.env << 'ENV'
APP_NAME="Perfume Store"
APP_ENV=production
APP_DEBUG=false
APP_URL=https://gt-academy.com
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_DATABASE=perfume_store
DB_USERNAME=perfume_user
DB_PASSWORD=Perfume2025!
CACHE_DRIVER=file
SESSION_DRIVER=file
ENV
php artisan key:generate --force
read -sp "MySQL root password: " PASS
echo ""
mysql -u root -p"$PASS" -e "CREATE DATABASE IF NOT EXISTS perfume_store; CREATE USER IF NOT EXISTS 'perfume_user'@'localhost' IDENTIFIED BY 'Perfume2025!'; GRANT ALL ON perfume_store.* TO 'perfume_user'@'localhost'; FLUSH PRIVILEGES;"
mysql -u perfume_user -pPerfume2025! perfume_store < /root/parfumes_db_backup.sql
cd $PROJECT/backend
mkdir -p storage/app/public storage/framework/{sessions,views,cache} storage/logs bootstrap/cache
php artisan storage:link --force && php artisan config:cache && php artisan route:cache
chown -R www-data:www-data $PROJECT && chmod -R 775 $PROJECT/backend/storage $PROJECT/backend/bootstrap/cache
cat > /etc/nginx/sites-available/gt-academy-parfumes << 'NGINX'
server {
listen 80;
server_name gt-academy.com;
root /var/www/html/gt-academy.com/parfumes;
index index.html;
location / { try_files $uri /index.html; }
location /backend/public { alias /var/www/html/gt-academy.com/parfumes/backend/public; try_files $uri @b; location ~ \.php$ { include snippets/fastcgi-php.conf; fastcgi_pass unix:/var/run/php/php8.1-fpm.sock; fastcgi_param SCRIPT_FILENAME $request_filename; } }
location @b { rewrite /backend/public/(.*)$ /backend/public/index.php?/$1 last; }
}
NGINX
ln -sf /etc/nginx/sites-available/gt-academy-parfumes /etc/nginx/sites-enabled/ && nginx -t && systemctl restart nginx php*-fpm
echo "DONE! Visit: http://gt-academy.com/"
